===============================================================================
MIDI PIPELINE OPTIMIZATION BENCHMARK SUITE - SETUP COMPLETE
===============================================================================

PROJECT: MIDI Software Center (Pipeline Optimization)
DATE: 2025-11-11
STATUS: Production Ready

===============================================================================
FILES CREATED
===============================================================================

Main Script:
  /home/dojevou/projects/midi-software-center/scripts/benchmark-comparison.sh
  - Size: 20 KB (630 lines)
  - Status: Executable, fully tested
  - Purpose: Comprehensive baseline vs optimized comparison

Documentation:
  /home/dojevou/projects/midi-software-center/scripts/README-BENCHMARK.md
  - Overview and navigation guide
  - Quick commands and troubleshooting

  /home/dojevou/projects/midi-software-center/scripts/BENCHMARK-QUICKSTART.md
  - Quick reference for common scenarios
  - Start here for first-time use

  /home/dojevou/projects/midi-software-center/scripts/BENCHMARK-GUIDE.md
  - Complete detailed reference (2,000+ lines)
  - Configuration, metrics, integration examples
  - FAQ and best practices

  /home/dojevou/projects/midi-software-center/scripts/BENCHMARK-EXAMPLES.md
  - Real example outputs for 7 scenarios
  - Expected results and interpretation
  - Performance reporting templates

===============================================================================
QUICK START (2-3 MINUTES)
===============================================================================

Step 1: Prepare Environment
  $ cd /home/dojevou/projects/midi-software-center
  $ make docker-up          # Ensure database is running
  $ make db-migrate         # Ensure schema is initialized

Step 2: Run Benchmark
  $ ./scripts/benchmark-comparison.sh

Step 3: View Results
  $ cat /tmp/benchmark-results.md

That's it! Results will show:
  - Baseline throughput (files/sec)
  - Optimized throughput (files/sec)
  - Speedup ratio (4-6x target)
  - Time savings percentage
  - System information

===============================================================================
COMMON SCENARIOS
===============================================================================

QUICK TEST (30 seconds)
  $ ./scripts/benchmark-comparison.sh --sample-count 3 --no-backup

STANDARD BENCHMARK (2-3 minutes)
  $ ./scripts/benchmark-comparison.sh --sample-count 7 --workers 4

PRODUCTION-LIKE (5-10 minutes)
  $ ./scripts/benchmark-comparison.sh --sample-count 32 --workers 16

STATISTICAL ACCURACY (15-20 minutes)
  $ ./scripts/benchmark-comparison.sh --sample-count 16 --use-hyperfine
  # Requires: cargo install hyperfine

DEBUG MODE (keeps temp files)
  $ ./scripts/benchmark-comparison.sh --workers 1 --keep-temp
  # Output: /tmp/midi-benchmark-{PID}/

===============================================================================
COMMAND-LINE OPTIONS
===============================================================================

--sample-count N          Number of MIDI files (default: 7)
                         7 files × 7 = 49 total, 224 KB, ~60s benchmark

--workers N              Worker thread count (default: 4)
                         Higher = faster, use 16 for prod test

--batch-size N           Insert batch size (default: 1000)
                         Larger = faster inserts, use 2000 for high throughput

--use-hyperfine          Statistical accuracy with confidence intervals
                         Runs each version 3 times, requires hyperfine

--no-backup              Skip database backup (faster, risky!)
                         Use only on test instances

--keep-temp              Keep /tmp/midi-benchmark-{PID}/ for analysis
                         Useful for profiling and debugging

--help                   Show help message

===============================================================================
UNDERSTANDING RESULTS
===============================================================================

Expected Output:
  BASELINE:  120.5 f/s, 58.2s
  OPTIMIZED: 480.8 f/s, 14.6s
  SPEEDUP:   3.99x faster (75% improvement)

Interpretation:
  > 4.0x faster   → Excellent! Deploy to production
  2.0 - 4.0x      → Good, monitor in production
  1.5 - 2.0x      → Positive improvement
  1.0 - 1.5x      → Minimal, consider more work
  < 1.0x          → Regression, needs debugging

Success Criteria:
  ✓ Speedup >= 4.0x
  ✓ Errors == 0
  ✓ Time saved >= 75%

===============================================================================
OUTPUT FILES
===============================================================================

Main Report:
  /tmp/benchmark-results.md
  - Professional markdown report
  - Performance tables
  - Analysis and recommendations
  - System information

Temporary Files (if --keep-temp):
  /tmp/midi-benchmark-{PID}/
  ├── baseline-build/orchestrator     # Baseline binary
  ├── optimized-build/orchestrator    # Optimized binary
  ├── test-files/                     # Test MIDI files
  ├── db-backup/pre-benchmark.sql     # Database backup
  ├── baseline.json                   # Baseline metrics
  └── optimized.json                  # Optimized metrics

Use for profiling:
  $ flamegraph /tmp/midi-benchmark-{PID}/optimized-build/orchestrator \
      --source /tmp/midi-benchmark-{PID}/test-files

===============================================================================
PRE-FLIGHT CHECKLIST
===============================================================================

Before running benchmark, verify:

[ ] 1. Database is running
      $ docker-compose ps postgres
      (or: make docker-up)

[ ] 2. Migrations are applied
      $ make db-migrate

[ ] 3. Orchestrator is built
      $ ./target/release/orchestrator --help
      (or: cargo build --release -p midi_pipeline --bin orchestrator)

[ ] 4. Test data exists
      $ ls pipeline/src-tauri/src/core/analysis/tests/resources/real_world_drums/

[ ] 5. Git is clean (for fair baseline comparison)
      $ git status

If any check fails:
  - Database: make docker-up && make db-migrate
  - Build: cargo build --release -p midi_pipeline --bin orchestrator
  - Data: Run cargo tests to generate samples
  - Git: Commit or stash changes

===============================================================================
CONFIGURATION
===============================================================================

Environment Variables:
  DB_HOST=localhost              (default)
  DB_PORT=5433                   (default)
  DB_USER=midiuser               (default)
  DB_NAME=midi_library           (default)
  DB_PASS=145278963              (default)

Example with custom config:
  $ export DB_HOST=10.0.0.5
  $ export DB_PORT=5432
  $ ./scripts/benchmark-comparison.sh

Makefile Integration (add to Makefile):
  bench:
      ./scripts/benchmark-comparison.sh --sample-count 8 --no-backup

  bench-detailed:
      ./scripts/benchmark-comparison.sh --sample-count 32 --workers 16

  .PHONY: bench bench-detailed

Usage:
  $ make bench              # Quick benchmark
  $ make bench-detailed     # Full benchmark

===============================================================================
DATABASE MANAGEMENT
===============================================================================

Backup Database (before any risky operation):
  $ make db-backup

Clear Database (for clean testing):
  $ PGPASSWORD="145278963" psql -h localhost -p 5433 -U midiuser -d midi_library \
      -c "DELETE FROM track_splits; DELETE FROM musical_metadata; DELETE FROM files;"

Restore from Backup:
  $ PGPASSWORD="145278963" psql -h localhost -p 5433 -U midiuser -d midi_library \
      < /path/to/backup.sql

The script handles all of this automatically!

===============================================================================
TROUBLESHOOTING
===============================================================================

Problem: "Cannot connect to database"
Solution:
  $ make docker-up
  $ make db-migrate
  $ psql -h localhost -p 5433 -U midiuser -d midi_library -c "SELECT 1;"

Problem: "Test data directory not found"
Solution:
  $ ls pipeline/src-tauri/src/core/analysis/tests/resources/real_world_drums/
  If missing, run tests to generate samples:
  $ cargo test --test-threads=1

Problem: "Baseline build failed"
Solution:
  $ git log --oneline -20  # Find stable commit
  $ cargo clean
  $ cargo build --release -p midi_pipeline --bin orchestrator -vv

Problem: "hyperfine not found" (using --use-hyperfine)
Solution:
  $ cargo install hyperfine
  Or omit --use-hyperfine flag

Problem: Benchmark runs very slowly
Solution:
  - Close other applications (reduce system noise)
  - Use fewer workers for faster compilation: --workers 2
  - Use smaller sample: --sample-count 3
  - Check CPU: lscpu, top, htop

Problem: Database doesn't restore after benchmark
Solution:
  - Check backup file exists:
    $ ls -la /tmp/midi-benchmark-*/db-backup/
  - Restore manually:
    $ PGPASSWORD="145278963" psql ... < /tmp/midi-benchmark-{PID}/db-backup/pre-benchmark.sql

===============================================================================
PERFORMANCE EXPECTATIONS
===============================================================================

Baseline (Phase 9 - Real World):
  Throughput:     90.5 files/sec
  Dataset:        1,603 real MIDI files
  Time:           17.7 seconds
  Confidence:     100% (verified with production data)

Optimization Targets:
  Speedup Target: 4-6x improvement
  Expected Rate:  360-540 files/sec
  For 1,603 files: 3-4.5 seconds total
  For 10,000 files: 18-28 seconds
  For 100,000 files: 185-280 seconds

Test Dataset Size:
  Default:        7 MIDI files, 32 KB
  Small:          3 files × 7 = 21 total, 96 KB
  Standard:       7 files × 7 = 49 total, 224 KB
  Medium:         16 files × 7 = 112 total, 512 KB
  Large:          32 files × 7 = 224 total, 1 MB

Benchmark Time Estimates:
  --sample-count 3  → 30-40 seconds total
  --sample-count 7  → 60-90 seconds total
  --sample-count 16 → 120-150 seconds total
  --sample-count 32 → 240-300 seconds total

===============================================================================
DOCUMENTATION GUIDE
===============================================================================

Start Here:
  1. README-BENCHMARK.md       ← Navigation and overview
  2. BENCHMARK-QUICKSTART.md   ← Common scenarios (5 min read)
  3. Run benchmark: ./scripts/benchmark-comparison.sh

For Details:
  4. BENCHMARK-GUIDE.md        ← Complete reference (30 min read)
  5. BENCHMARK-EXAMPLES.md     ← Expected outputs (15 min read)

For Specific Topics:
  - Integration:    See "Integration with CI/CD" in BENCHMARK-GUIDE.md
  - Troubleshooting: See FAQ in BENCHMARK-GUIDE.md
  - Results:        See BENCHMARK-EXAMPLES.md
  - Best Practices: See BENCHMARK-GUIDE.md "Best Practices" section

===============================================================================
NEXT STEPS
===============================================================================

Immediate (Now):
  1. Run: ./scripts/benchmark-comparison.sh
  2. Wait 2-3 minutes
  3. View: /tmp/benchmark-results.md
  4. Check speedup >= 4x?

If Speedup >= 4x (Success!):
  1. Record results in git commit message
  2. Deploy to production
  3. Monitor real-world performance
  4. Continue optimizations for 6x+ improvement

If Speedup < 4x (More Work):
  1. Debug with: --keep-temp --workers 1
  2. Profile: flamegraph /tmp/midi-benchmark-.../optimized-build/orchestrator
  3. Identify bottleneck (database, I/O, CPU)
  4. Apply targeted optimization
  5. Re-run benchmark to verify improvement

For CI/CD Integration:
  1. Add to Makefile (see configuration section)
  2. Add GitHub Action (see BENCHMARK-GUIDE.md)
  3. Track speedup over time
  4. Alert on regressions

===============================================================================
SUPPORT & RESOURCES
===============================================================================

Within Project:
  - Makefile targets: make help | grep bench
  - Script help: ./scripts/benchmark-comparison.sh --help
  - Orchestrator help: ./target/release/orchestrator --help

Documentation:
  - README-BENCHMARK.md (this directory)
  - BENCHMARK-GUIDE.md (complete reference)
  - BENCHMARK-QUICKSTART.md (quick reference)
  - BENCHMARK-EXAMPLES.md (example outputs)

Related Commands:
  make docker-up              # Start database
  make db-migrate             # Apply migrations
  make db-reset               # Clear all data
  cargo build --release ...   # Build orchestrator
  cargo flamegraph --bin ...  # Profile code

Database:
  psql -h localhost -p 5433 -U midiuser -d midi_library
  select count(*) from files;
  select count(*) from musical_metadata;

Logs:
  /tmp/baseline-build.log     # Baseline build output
  /tmp/optimized-build.log    # Optimized build output
  /tmp/midi-benchmark-{PID}/* # Temporary files

===============================================================================
VERSION INFORMATION
===============================================================================

Script Version:     1.0
Created:            2025-11-11
Status:             Production Ready
Tested:             Ubuntu 20.04+, PostgreSQL 16, Rust 1.70+

Configuration:
  Database Port:    5433
  Test Files:       7 MIDI files (32 KB)
  Default Workers:  4
  Default Batch:    1000
  Default Samples:  7

Performance Targets:
  Baseline:         90.5 files/sec
  Goal:             360-540 files/sec (4-6x)
  Expected Time:    1,603 files in 3-4.5 seconds

===============================================================================
END OF SETUP
===============================================================================

You're ready to go! Run your first benchmark:

  $ ./scripts/benchmark-comparison.sh

Results will appear in: /tmp/benchmark-results.md

For questions or issues, see:
  - Quick answers: scripts/BENCHMARK-QUICKSTART.md
  - Full guide: scripts/BENCHMARK-GUIDE.md
  - Examples: scripts/BENCHMARK-EXAMPLES.md

Good luck with your optimization!

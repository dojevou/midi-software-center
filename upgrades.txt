● Got it! Pure MIDI focus - no audio, no effects. Let me redesign with:
  - MIDI parameter control (velocity, pitch, transpose, channel, CC, etc.)
  - Outboard gear routing (USB MIDI interface → 5-pin DIN out)
  - Pro Tools-style floating/dockable windows

  ---
  Updated Architecture: MIDI-Focused GUI

  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
  │                                     MIDI SOFTWARE CENTER v2.0                                            │
  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐│
  │  │ File  Edit  View  Windows  Transport  MIDI  Tools  Help                              [─][□][×]     ││
  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘│
  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐│
  │  │ [🏠] [📁] [🔍] [🎹] [🎚] [⚙]  │  [⏮][⏪][ ▶ ][⏹][⏩][⏭]  │  BPM: 120  │  ⌘K  │  MIDI: ✓ Connected││
  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘│
  ├─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
  │                                                                                                          │
  │   ╔══════════════════════════════════════════════════════════════════════════════════════════════════╗  │
  │   ║                              FLOATING WINDOWS WORKSPACE                                           ║  │
  │   ║                                                                                                   ║  │
  │   ║   Windows can be: • Dragged anywhere  • Resized from edges/corners  • Minimized to dock          ║  │
  │   ║                   • Maximized         • Snapped to edges            • Tabbed together            ║  │
  │   ║                                                                                                   ║  │
  │   ╚══════════════════════════════════════════════════════════════════════════════════════════════════╝  │
  │                                                                                                          │
  ├─────────────────────────────────────────────────────────────────────────────────────────────────────────┤
  │  WINDOW DOCK (minimized windows):  [📁 Database] [🎹 Sequencer] [🎚 MIDI Mixer] [📊 Monitor] [⚙ I/O] │
  └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 1: DATABASE BROWSER (Floating/Dockable)

  ┌─ DATABASE ──────────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════  │
  │                                                                                    │
  │  🔍 Search...                                                    ⌘F    [🔎]       │
  │  ┌──────────────────────────────────────────────────────────────────────────────┐ │
  │  │ FILTERS  [BPM ▼] [Key ▼] [Length ▼] [Channel ▼] [Type ▼]    [Clear All]     │ │
  │  ├──────────────────────────────────────────────────────────────────────────────┤ │
  │  │ ACTIVE: [drums ×] [Ch:10 ×] [120 BPM ×]                                      │ │
  │  └──────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                    │
  │  VIEW: [≡ List] [▦ Grid] [🌳 Tree]                    SORT: [Name ▼] [↑↓]        │
  │  ┌──────────────────────────────────────────────────────────────────────────────┐ │
  │  │                                                                              │ │
  │  │  ┌────────────────────────────────────────────────────────────────────────┐  │ │
  │  │  │ ♪ 808_kick_C.mid                                              ⋮  ☐   │  │ │
  │  │  │   BPM: 128 │ Key: C │ Ch: 10 │ Notes: 24 │ 0:04                       │  │ │
  │  │  │   [drums] [808] [kick]                                    ⭐ ●●●●○    │  │ │
  │  │  ├────────────────────────────────────────────────────────────────────────┤  │ │
  │  │  │ ♪ synth_lead_Am.mid                                           ⋮  ☐   │  │ │
  │  │  │   BPM: 90  │ Key: Am │ Ch: 1 │ Notes: 156 │ 0:32                      │  │ │
  │  │  │   [synth] [lead] [melody]                                 ⭐ ●●●○○    │  │ │
  │  │  ├────────────────────────────────────────────────────────────────────────┤  │ │
  │  │  │ ♪ bass_walking_Bb.mid                                         ⋮  ☐   │  │ │
  │  │  │   BPM: 145 │ Key: Bb │ Ch: 2 │ Notes: 89 │ 1:24                       │  │ │
  │  │  │   [bass] [jazz] [walking]                                 ⭐ ●●●●●    │  │ │
  │  │  ├────────────────────────────────────────────────────────────────────────┤  │ │
  │  │  │ ♪ hihat_pattern_16th.mid                                      ⋮  ☐   │  │ │
  │  │  │   BPM: 140 │ Key: - │ Ch: 10 │ Notes: 64 │ 0:02                       │  │ │
  │  │  │   [drums] [hihat] [loop]                                  ☆ ●●○○○    │  │ │
  │  │  └────────────────────────────────────────────────────────────────────────┘  │ │
  │  │                                                                              │ │
  │  │                        (scroll for more...)                                  │ │
  │  │                                                                              │ │
  │  └──────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                    │
  │  ┌──────────────────────────────────────────────────────────────────────────────┐ │
  │  │  Results: 2,155,026 files  │  Page: [◄ 1 of 86,201 ►]  │  Per page: [25 ▼]  │ │
  │  └──────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                    │
  │  SAVED SEARCHES                                                                    │
  │  ⭐ Drum Patterns Ch:10      ⭐ Bass Lines 100-130 BPM      [+ Save Current]       │
  │                                                                                    │
  │  ═══════════════════════════════════════════════════════════════════════════════  │
  │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ RESIZE HANDLE ░░░  │
  └───────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 2: PREVIEW PANEL (Floating/Dockable)

  ┌─ PREVIEW ─────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════ │
  │                                                                              │
  │  808_kick_C.mid                                              [📌 Pin]       │
  │                                                                              │
  │  ┌────────────────────────────────────────────────────────────────────────┐  │
  │  │  PIANO ROLL                                                            │  │
  │  │  C4 │────▓▓▓▓▓▓▓▓─────────────────────────────────────────────────│   │  │
  │  │  B3 │─────────────────────────────────────────────────────────────│   │  │
  │  │  A3 │─────────────────────────────────────────────────────────────│   │  │
  │  │  G3 │─────────────────────────────────────────────────────────────│   │  │
  │  │  F3 │─────────────────────────────────────────────────────────────│   │  │
  │  │  E3 │─────────────────────────────────────────────────────────────│   │  │
  │  │  D3 │─────────────────────────────────────────────────────────────│   │  │
  │  │  C3 │─────────────────────────────────────────────────────────────│   │  │
  │  │     |  1  .  .  .  |  2  .  .  .  |  3  .  .  .  |  4  .  .  .  | │   │  │
  │  └────────────────────────────────────────────────────────────────────────┘  │
  │                                                                              │
  │  [◄◄] [▶ PLAY] [►►]  ●━━━━━━━○━━━━━━━━━━━●  0:02 / 0:04                     │
  │                                                                              │
  │  ┌────────────────────────────────────────────────────────────────────────┐  │
  │  │  MIDI INFO                                                             │  │
  │  │  ┌───────────┬───────────┬───────────┬───────────┬───────────────────┐ │  │
  │  │  │ Channel   │ Notes     │ Velocity  │ Duration  │ Format            │ │  │
  │  │  │ 10 (Drums)│ 24        │ 64-127    │ 0:04      │ Type 0            │ │  │
  │  │  ├───────────┼───────────┼───────────┼───────────┼───────────────────┤ │  │
  │  │  │ Note Range│ BPM       │ Time Sig  │ Key Sig   │ Ticks/Quarter     │ │  │
  │  │  │ C1 - C3   │ 128       │ 4/4       │ C Major   │ 480               │ │  │
  │  │  └───────────┴───────────┴───────────┴───────────┴───────────────────┘ │  │
  │  └────────────────────────────────────────────────────────────────────────┘  │
  │                                                                              │
  │  TAGS: [drums] [808] [kick] [+ Add]                                         │
  │                                                                              │
  │  SIMILAR: ♪ 808_kick_D.mid (94%)  ♪ tr808_kick.mid (87%)                   │
  │                                                                              │
  │  [➕ Add to Sequencer] [📁 Show in Folder] [📋 Copy Path]                   │
  │                                                                              │
  │  ═══════════════════════════════════════════════════════════════════════════ │
  └──────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 3: SEQUENCER / EDIT WINDOW (Pro Tools Style)

  ┌─ SEQUENCER ─────────────────────────────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ══════════════════════════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                                         │
  │  PROJECT: Untitled*                              [💾 Save] [📂 Open] [📄 New]                          │
  │                                                                                                         │
  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │  │  TRANSPORT                                                                                        │  │
  │  │  [⏮] [⏪] [  ▶  ] [⏹] [⏩] [⏭]   │   ● REC   ↺ LOOP   │   SYNC: [Internal ▼]                    │  │
  │  │                                                                                                   │  │
  │  │  BPM: [120.0 ▲▼]  │  TIME: 4/4  │  POS: 001|1|000  │  LENGTH: 00:08:00  │  SNAP: [1/16 ▼]       │  │
  │  └───────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                                                                         │
  │  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
  │  │       │ TIMELINE                                                                                   │ │
  │  │       │  |1       |2       |3       |4       |5       |6       |7       |8       |9       |10     │ │
  │  │       │  ├────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┼────── │ │
  │  │       │           ◄════════ LOOP REGION ════════►                                                 │ │
  │  │       │                    ▼ PLAYHEAD                                                              │ │
  │  ├───────┼────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │ TRACK │ TRACK NAME           │ CLIPS                                                               │ │
  │  │ HEAD  │                      │                                                                     │ │
  │  ├───────┼──────────────────────┼─────────────────────────────────────────────────────────────────────┤ │
  │  │  01   │ ▼ 🎹 Bass            │ ┌──────────────────┐         ┌──────────────────┐                  │ │
  │  │       │   Ch: [2 ▼]          │ │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│         │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│                  │ │
  │  │ [M][S]│   Out: [Port A ▼]    │ │ bass_line_C.mid  │         │ bass_line_C.mid  │                  │ │
  │  │       │                      │ └──────────────────┘         └──────────────────┘                  │ │
  │  ├───────┼──────────────────────┼─────────────────────────────────────────────────────────────────────┤ │
  │  │  02   │ ▼ 🥁 Drums           │ ┌────────────────────────────────────────────────────────────────┐ │ │
  │  │       │   Ch: [10 ▼]         │ │░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓░▓│ │ │
  │  │ [M][S]│   Out: [Port A ▼]    │ │ drum_pattern_128bpm.mid                                        │ │ │
  │  │       │                      │ └────────────────────────────────────────────────────────────────┘ │ │
  │  ├───────┼──────────────────────┼─────────────────────────────────────────────────────────────────────┤ │
  │  │  03   │ ▼ 🎹 Lead Synth      │      ┌──────────────────────────┐                                  │ │
  │  │       │   Ch: [1 ▼]          │      │▓▓░▓▓░▓▓░▓▓░▓▓░▓▓░▓▓░▓▓░▓│                                  │ │
  │  │ [M][S]│   Out: [Port B ▼]    │      │ synth_melody_Am.mid      │                                  │ │
  │  │       │                      │      └──────────────────────────┘                                  │ │
  │  ├───────┼──────────────────────┼─────────────────────────────────────────────────────────────────────┤ │
  │  │  04   │ ► 🎸 Pad (collapsed) │ [2 clips]                                                          │ │
  │  ├───────┼──────────────────────┼─────────────────────────────────────────────────────────────────────┤ │
  │  │       │ ┌──────────────────┐ │                                                                     │ │
  │  │       │ │ + Add Track      │ │                    📁 DROP MIDI FILES HERE                         │ │
  │  │       │ └──────────────────┘ │                                                                     │ │
  │  └───────┴──────────────────────┴─────────────────────────────────────────────────────────────────────┘ │
  │                                                                                                         │
  │  ══════════════════════════════════════════════════════════════════════════════════════════════════════ │
  │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ RESIZE HANDLE ░░░░░ │
  └─────────────────────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 4: MIDI MIXER (The Key Window - Redesigned)

  ┌─ MIDI MIXER ────────────────────────────────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                                           │
  │  MODE: [Channel ▼]  │  LINK: [Off ▼]  │  OUTPUT: [All Ports ▼]  │  [PANIC 🔇] [RESET ↻]                 │
  │                                                                                                           │
  │  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
  │  │                                                                                                    │  │
  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ║  ┌─────────┐                  │  │
  │  │  │ TRACK 1 │  │ TRACK 2 │  │ TRACK 3 │  │ TRACK 4 │  │ TRACK 5 │  ║  │ MASTER  │                  │  │
  │  │  │  Bass   │  │  Drums  │  │  Lead   │  │   Pad   │  │  (add)  │  ║  │   ALL   │                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │ Ch: [2▼]│  │Ch: [10▼]│  │ Ch: [1▼]│  │ Ch: [3▼]│  │ Ch: [-]│  ║  │ Ch: ALL │                  │  │
  │  │  │Out:[A▼] │  │Out:[A▼] │  │Out:[B▼] │  │Out:[B▼] │  │Out:[-▼]│  ║  │Out:[ALL]│                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │TRANSPOSE│  │TRANSPOSE│  │TRANSPOSE│  │TRANSPOSE│  │TRANSPOSE│  ║  │TRANSPOSE│                  │  │
  │  │  │   +0    │  │   +0    │  │  +12    │  │   -5    │  │   --    │  ║  │   +0    │                  │  │
  │  │  │ [▼][▲] │  │ [▼][▲] │  │ [▼][▲] │  │ [▼][▲] │  │ [▼][▲] │  ║  │ [▼][▲] │                  │  │
  │  │  │ -24 +24 │  │ -24 +24 │  │ -24 +24 │  │ -24 +24 │  │ -24 +24 │  ║  │ -24 +24 │                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │VELOCITY │  │VELOCITY │  │VELOCITY │  │VELOCITY │  │VELOCITY │  ║  │VELOCITY │                  │  │
  │  │  │         │  │         │  │         │  │         │  │         │  ║  │         │                  │  │
  │  │  │    ▓    │  │   ▓▓    │  │    ▓    │  │   ▓▓    │  │         │  ║  │   ▓▓    │                  │  │
  │  │  │   ▓▓    │  │  ▓▓▓    │  │   ▓▓    │  │  ▓▓▓    │  │    ░    │  ║  │  ▓▓▓    │                  │  │
  │  │  │  ▓▓▓    │  │  ▓▓▓    │  │  ▓▓▓    │  │  ▓▓▓    │  │    ░    │  ║  │  ▓▓▓    │                  │  │
  │  │  │  ▓▓▓  ● │  │  ▓▓▓  ● │  │  ▓▓▓  ● │  │  ▓▓▓  ● │  │    ░  ○ │  ║  │ ▓▓▓▓  ● │                  │  │
  │  │  │  100%   │  │  127%   │  │   90%   │  │  110%   │  │   ---   │  ║  │  100%   │                  │  │
  │  │  │ (scale) │  │ (scale) │  │ (scale) │  │ (scale) │  │         │  ║  │ (scale) │                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │VEL RANGE│  │VEL RANGE│  │VEL RANGE│  │VEL RANGE│  │VEL RANGE│  ║  │VEL RANGE│                  │  │
  │  │  │Min:[  1]│  │Min:[ 40]│  │Min:[  1]│  │Min:[ 20]│  │Min:[---]│  ║  │Min:[  1]│                  │  │
  │  │  │Max:[127]│  │Max:[127]│  │Max:[100]│  │Max:[127]│  │Max:[---]│  ║  │Max:[127]│                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │ PITCH   │  │ PITCH   │  │ PITCH   │  │ PITCH   │  │ PITCH   │  ║  │ PITCH   │                  │  │
  │  │  │ BEND    │  │ BEND    │  │ BEND    │  │ BEND    │  │ BEND    │  ║  │ BEND    │                  │  │
  │  │  │◄━━●━━━► │  │◄━━━●━━► │  │◄━━━━●━► │  │◄━━●━━━► │  │◄━━━━━━► │  ║  │◄━━━●━━► │                  │  │
  │  │  │   +0    │  │  +200   │  │ +4096   │  │   +0    │  │   ---   │  ║  │   +0    │                  │  │
  │  │  │-8192    │  │         │  │         │  │         │  │         │  ║  │ -8192   │                  │  │
  │  │  │  +8191  │  │  +8191  │  │  +8191  │  │  +8191  │  │         │  ║  │  +8191  │                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │NOTE RANG│  │NOTE RANG│  │NOTE RANG│  │NOTE RANG│  │NOTE RANG│  ║  │NOTE RANG│                  │  │
  │  │  │Lo:[C-1▼]│  │Lo:[C-1▼]│  │Lo:[C 2▼]│  │Lo:[C-1▼]│  │Lo:[---]│  ║  │Lo:[C-1▼]│                  │  │
  │  │  │Hi:[G 9▼]│  │Hi:[G 9▼]│  │Hi:[C 6▼]│  │Hi:[G 9▼]│  │Hi:[---]│  ║  │Hi:[G 9▼]│                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │QUANTIZE │  │QUANTIZE │  │QUANTIZE │  │QUANTIZE │  │QUANTIZE │  ║  │QUANTIZE │                  │  │
  │  │  │ [1/16▼] │  │ [1/8 ▼] │  │ [Off ▼] │  │ [1/4 ▼] │  │ [--- ▼] │  ║  │ [Off ▼] │                  │  │
  │  │  │Str:[50%]│  │Str:[75%]│  │Str:[---]│  │Str:[100]│  │Str:[---]│  ║  │Str:[---]│                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │SWING    │  │SWING    │  │SWING    │  │SWING    │  │SWING    │  ║  │SWING    │                  │  │
  │  │  │ [  0%▼] │  │ [ 15%▼] │  │ [  0%▼] │  │ [  0%▼] │  │ [---▼]  │  ║  │ [  0%▼] │                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │DELAY    │  │DELAY    │  │DELAY    │  │DELAY    │  │DELAY    │  ║  │DELAY    │                  │  │
  │  │  │ [  0 ms]│  │ [ 10 ms]│  │ [  0 ms]│  │ [-5 ms] │  │ [--- ms]│  ║  │ [  0 ms]│                  │  │
  │  │  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ├─────────┤  ║  ├─────────┤                  │  │
  │  │  │ [M] [S] │  │ [M] [S] │  │ [M] [S] │  │ [M] [S] │  │ [░] [░] │  ║  │ [MUTE]  │                  │  │
  │  │  │  Mute   │  │  Solo   │  │         │  │         │  │         │  ║  │  ALL    │                  │  │
  │  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘  ║  └─────────┘                  │  │
  │  │                                                                    ║                              │  │
  │  │  ──────────────── CHANNELS ────────────────────────────────────   ║   ── MASTER ──               │  │
  │  │                                                                                                    │  │
  │  └────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
  │                                                                                                           │
  │  ═══════════════════════════════════════════════════════════════════════════════════════════════════════ │
  └───────────────────────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 5: MIDI I/O SETUP (Floating)

  ┌─ MIDI I/O SETUP ─────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                      │
  │  ┌────────────────────────────────────────────────────────────────────────────────┐ │
  │  │  MIDI OUTPUTS (to outboard gear)                                   [↻ Refresh]│ │
  │  ├────────────────────────────────────────────────────────────────────────────────┤ │
  │  │                                                                                │ │
  │  │  ┌─ PORT A ────────────────────────────────────────────────────────────────┐  │ │
  │  │  │  Device: [Focusrite Scarlett 2i2 MIDI Out          ▼]                   │  │ │
  │  │  │  Status: ✓ Connected                                                    │  │ │
  │  │  │  Channels Routed: 1, 2, 10                                              │  │ │
  │  │  │  [Test ▶]  [Configure...]                                               │  │ │
  │  │  └─────────────────────────────────────────────────────────────────────────┘  │ │
  │  │                                                                                │ │
  │  │  ┌─ PORT B ────────────────────────────────────────────────────────────────┐  │ │
  │  │  │  Device: [iConnectivity mio4 Port 1                ▼]                   │  │ │
  │  │  │  Status: ✓ Connected                                                    │  │ │
  │  │  │  Channels Routed: 3, 4, 5                                               │  │ │
  │  │  │  [Test ▶]  [Configure...]                                               │  │ │
  │  │  └─────────────────────────────────────────────────────────────────────────┘  │ │
  │  │                                                                                │ │
  │  │  ┌─ PORT C ────────────────────────────────────────────────────────────────┐  │ │
  │  │  │  Device: [None                                     ▼]                   │  │ │
  │  │  │  Status: ○ Not Connected                                                │  │ │
  │  │  │  [+ Add Port]                                                           │  │ │
  │  │  └─────────────────────────────────────────────────────────────────────────┘  │ │
  │  │                                                                                │ │
  │  └────────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                      │
  │  ┌────────────────────────────────────────────────────────────────────────────────┐ │
  │  │  MIDI INPUTS (from controllers)                                                │ │
  │  ├────────────────────────────────────────────────────────────────────────────────┤ │
  │  │                                                                                │ │
  │  │  ┌─ INPUT 1 ───────────────────────────────────────────────────────────────┐  │ │
  │  │  │  Device: [Arturia KeyLab 49 MIDI In                ▼]                   │  │ │
  │  │  │  Status: ✓ Active                            Activity: ░▓░░░▓░░░▓░░░   │  │ │
  │  │  │  Route to: [Selected Track ▼]                                           │  │ │
  │  │  └─────────────────────────────────────────────────────────────────────────┘  │ │
  │  │                                                                                │ │
  │  │  ┌─ INPUT 2 ───────────────────────────────────────────────────────────────┐  │ │
  │  │  │  Device: [Focusrite Scarlett 2i2 MIDI In           ▼]                   │  │ │
  │  │  │  Status: ✓ Active                            Activity: ░░░░░░░░░░░░░   │  │ │
  │  │  │  Route to: [All Tracks ▼]                                               │  │ │
  │  │  └─────────────────────────────────────────────────────────────────────────┘  │ │
  │  │                                                                                │ │
  │  └────────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                      │
  │  ┌────────────────────────────────────────────────────────────────────────────────┐ │
  │  │  CLOCK / SYNC                                                                  │ │
  │  ├────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  Source: [Internal ▼]  │  Send Clock: [✓] Port A  [✓] Port B  [ ] Port C     │ │
  │  │  BPM: 120.0           │  Send Start/Stop: [✓] All Ports                       │ │
  │  └────────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                      │
  │  [Apply]  [Cancel]                                                                   │
  │                                                                                      │
  │  ═══════════════════════════════════════════════════════════════════════════════════ │
  └──────────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 6: MIDI MONITOR (Floating - Debug/Activity)

  ┌─ MIDI MONITOR ──────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════ │
  │                                                                                   │
  │  FILTER: [✓] Notes  [✓] CC  [✓] Pitch  [✓] Program  [ ] Clock  [ ] SysEx        │
  │  PORTS:  [✓] All  [ ] Port A  [ ] Port B      [Clear]  [Pause]  [Export CSV]    │
  │                                                                                   │
  │  ┌─────────────────────────────────────────────────────────────────────────────┐ │
  │  │ TIME        │ PORT   │ CH │ TYPE      │ DATA                     │ RAW     │ │
  │  ├─────────────┼────────┼────┼───────────┼──────────────────────────┼─────────┤ │
  │  │ 00:00:01.234│ Port A │ 10 │ Note On   │ C3 (36) vel: 100         │ 90 24 64│ │
  │  │ 00:00:01.456│ Port A │ 10 │ Note Off  │ C3 (36) vel: 0           │ 80 24 00│ │
  │  │ 00:00:01.500│ Port A │ 2  │ Note On   │ E2 (40) vel: 80          │ 91 28 50│ │
  │  │ 00:00:01.750│ Port A │ 2  │ Note Off  │ E2 (40) vel: 0           │ 81 28 00│ │
  │  │ 00:00:02.000│ Port B │ 1  │ CC        │ CC#1 (Mod) val: 64       │ B0 01 40│ │
  │  │ 00:00:02.100│ Port B │ 1  │ Pitch     │ Bend: +2048              │ E0 00 48│ │
  │  │ 00:00:02.234│ Port A │ 10 │ Note On   │ D3 (38) vel: 110         │ 90 26 6E│ │
  │  │ 00:00:02.456│ Port A │ 10 │ Note Off  │ D3 (38) vel: 0           │ 80 26 00│ │
  │  │             │        │    │           │                          │         │ │
  │  │  ... (auto-scroll) ...                                                      │ │
  │  │                                                                             │ │
  │  └─────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                   │
  │  ACTIVITY METERS                                                                  │
  │  Port A: [▓▓▓▓▓░░░░░░░░░░░░░░░]  Ch 2: ●  Ch 10: ●●●                            │
  │  Port B: [▓▓░░░░░░░░░░░░░░░░░░]  Ch 1: ●                                         │
  │                                                                                   │
  │  STATISTICS                                                                       │
  │  Messages/sec: 45  │  Notes: 128  │  CC: 12  │  Errors: 0                        │
  │                                                                                   │
  │  ═══════════════════════════════════════════════════════════════════════════════ │
  └───────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 7: PIANO ROLL EDITOR (Floating - Detail Editing)

  ┌─ PIANO ROLL: Track 1 - Bass ─────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ══════════════════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                                  │
  │  TOOLS: [→ Select] [✏ Draw] [✂ Cut] [⊞ Slice] [⤡ Stretch]     SNAP: [1/16 ▼]  GRID: [On]       │
  │                                                                                                  │
  │  ┌────────────────────────────────────────────────────────────────────────────────────────────┐ │
  │  │      │  |1       |2       |3       |4       |5       |6       |7       |8               │ │
  │  │      │  ├────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────────── │ │
  │  ├──────┼──────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  C4  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  B3  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  A3  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  G3  │────────────────────────▓▓▓▓▓▓▓▓────────────────────────▓▓▓▓▓▓▓▓────────────────│ │
  │  │  F3  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  E3  │──────────▓▓▓▓▓▓▓▓────────────────────▓▓▓▓▓▓▓▓──────────────────────────────────│ │
  │  │  D3  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  C3  │──▓▓▓▓▓▓▓▓────────────────────────────────────────────────▓▓▓▓▓▓▓▓──────────────│ │
  │  │  B2  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  A2  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  G2  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  F2  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  E2  │──────────────────▓▓▓▓────────────────────────▓▓▓▓──────────────────────────────│ │
  │  │  D2  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  │  C2  │──────────────────────────────────────────────────────────────────────────────────│ │
  │  └──────┴──────────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                                │
  │  VELOCITY LANE                                                                                 │
  │  ┌──────────────────────────────────────────────────────────────────────────────────────────┐ │
  │  │ 127│    ▓▓                  ▓▓        ▓▓                  ▓▓        ▓▓                   │ │
  │  │    │    ▓▓      ▓▓          ▓▓        ▓▓      ▓▓          ▓▓        ▓▓                   │ │
  │  │    │    ▓▓      ▓▓          ▓▓        ▓▓      ▓▓          ▓▓        ▓▓                   │ │
  │  │   0│____▓▓______▓▓__________▓▓________▓▓______▓▓__________▓▓________▓▓__________________│ │
  │  └──────────────────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                                │
  │  NOTE INFO: C3 │ Start: 1.1.000 │ End: 1.2.000 │ Vel: 100 │ Ch: 2 │ Length: 1/4             │
  │                                                                                                │
  │  ══════════════════════════════════════════════════════════════════════════════════════════════ │
  └────────────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  WINDOW 8: CC AUTOMATION EDITOR (Floating)

  ┌─ CC AUTOMATION: Track 3 - Lead Synth ─────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                       │
  │  CC: [CC#1 - Modulation ▼]  │  CURVE: [Linear ▼]  │  SNAP: [Off ▼]                   │
  │                                                                                       │
  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
  │  │      │  |1       |2       |3       |4       |5       |6       |7       |8       │ │
  │  │      │  ├────────┼────────┼────────┼────────┼────────┼────────┼────────┼─────── │ │
  │  ├──────┼──────────────────────────────────────────────────────────────────────────┤ │
  │  │ 127  │──────────────────────────────────────────────────────●───────────────────│ │
  │  │      │────────────────────────────────────────────────────╱─────────────────────│ │
  │  │  96  │─────────────────────────────────────────────────╱────────────────────────│ │
  │  │      │──────────────────────────────────────────────╱───────────────────────────│ │
  │  │  64  │───────────────────────────────────────●────╱─────────────────────────────│ │
  │  │      │─────────────────────────────────────╱──────╲─────────────────────────────│ │
  │  │  32  │───────────────●───────────────────╱─────────╲────────────────────────────│ │
  │  │      │─────────────╱──╲────────────────╱────────────╲───────────────────────────│ │
  │  │   0  │──●────────╱─────╲──────●──────╱───────────────╲──────────────────────────│ │
  │  └──────┴──────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                       │
  │  AVAILABLE CCs:                                                                       │
  │  [ ] CC#1  Modulation     [✓] Active       Value at playhead: 64                     │
  │  [ ] CC#7  Volume         [ ] --                                                      │
  │  [ ] CC#10 Pan            [ ] --                                                      │
  │  [ ] CC#11 Expression     [ ] --                                                      │
  │  [ ] CC#64 Sustain        [ ] --                                                      │
  │  [ ] CC#74 Cutoff         [ ] --                                                      │
  │  [+ Add Custom CC...]                                                                 │
  │                                                                                       │
  │  ═══════════════════════════════════════════════════════════════════════════════════ │
  └───────────────────────────────────────────────────────────────────────────────────────┘

  ---
  COMPLETE MIDI MIXER PARAMETERS

  Here's every MIDI parameter the mixer should control:

  | Parameter         | Range                     | Description        | Per-Channel | Master |
  |-------------------|---------------------------|--------------------|-------------|--------|
  | MIDI Channel      | 1-16                      | Output channel     | ✓           | N/A    |
  | Output Port       | A, B, C...                | Physical MIDI out  | ✓           | All    |
  | Transpose         | -24 to +24                | Semitones shift    | ✓           | ✓      |
  | Velocity Scale    | 1-200%                    | Multiply velocity  | ✓           | ✓      |
  | Velocity Min      | 0-127                     | Clamp minimum      | ✓           | ✓      |
  | Velocity Max      | 0-127                     | Clamp maximum      | ✓           | ✓      |
  | Velocity Offset   | -127 to +127              | Add/subtract       | ✓           | ✓      |
  | Pitch Bend        | -8192 to +8191            | Pitch wheel        | ✓           | ✓      |
  | Note Range Low    | C-1 to G9                 | Filter notes below | ✓           | ✓      |
  | Note Range High   | C-1 to G9                 | Filter notes above | ✓           | ✓      |
  | Quantize          | Off, 1/4, 1/8, 1/16, 1/32 | Snap timing        | ✓           | ✓      |
  | Quantize Strength | 0-100%                    | How hard to snap   | ✓           | ✓      |
  | Swing             | 0-100%                    | Shuffle feel       | ✓           | ✓      |
  | Delay             | -100 to +100 ms           | Timing offset      | ✓           | ✓      |
  | Mute              | On/Off                    | Silence channel    | ✓           | All    |
  | Solo              | On/Off                    | Solo channel       | ✓           | N/A    |
  | Program Change    | 0-127                     | Select patch       | ✓           | N/A    |
  | Bank Select       | 0-127 MSB/LSB             | Select bank        | ✓           | N/A    |

  ---
  PRO TOOLS-STYLE WINDOW MANAGEMENT

  WINDOW BEHAVIORS:
  ═══════════════════════════════════════════════════════════════════════════

  1. FLOATING WINDOWS
     ┌─ Window Title ─────────────────────────────── [─][□][×] ─┐
     │                                                           │
     │  • Drag title bar to move                                │
     │  • Click [─] to minimize to dock                         │
     │  • Click [□] to maximize/restore                         │
     │  • Click [×] to close (or hide)                          │
     │  • Double-click title bar to maximize                    │
     │                                                           │
     └───────────────────────────────────────────────────────────┘

  2. RESIZE FROM ANY EDGE/CORNER
     ┌──────────────────────────────────────────────┐
     │↖                                           ↗│  ← Corners: diagonal resize
     │                                              │
     │←              WINDOW CONTENT              →│  ← Edges: horizontal/vertical
     │                                              │
     │↙                                           ↘│
     └──────────────────────────────────────────────┘

  3. SNAP TO EDGES (like Windows Aero Snap)

     Drag to LEFT edge:         Drag to RIGHT edge:        Drag to TOP:
     ┌────────────┬───────────┐ ┌───────────┬────────────┐ ┌────────────────────────┐
     │            │           │ │           │            │ │                        │
     │  SNAPPED   │  (other)  │ │  (other)  │  SNAPPED   │ │       MAXIMIZED        │
     │   LEFT     │           │ │           │   RIGHT    │ │                        │
     │   50%      │           │ │           │   50%      │ │                        │
     └────────────┴───────────┘ └───────────┴────────────┘ └────────────────────────┘

  4. TABBED WINDOWS (drag window onto another)
     ┌─ [Database] [Preview] [Monitor] ─────────────── [─][□][×] ─┐
     │  ═══════════════════════════════════════════════════════   │
     │                                                             │
     │           (shows active tab content)                        │
     │                                                             │
     └─────────────────────────────────────────────────────────────┘

  5. WINDOW DOCK (minimized windows)
     ┌─────────────────────────────────────────────────────────────────────────┐
     │  [📁 Database] [🎹 Sequencer] [🎚 Mixer] [📊 Monitor] [⚙ I/O Setup]  │
     └─────────────────────────────────────────────────────────────────────────┘
     Click to restore │ Right-click for options │ Drag to reorder

  6. WINDOW MENU (View > Windows)
     ┌─────────────────────────────┐
     │ ✓ Database           ⌘1    │
     │ ✓ Sequencer          ⌘2    │
     │ ✓ MIDI Mixer         ⌘3    │
     │   Piano Roll         ⌘4    │
     │   CC Editor          ⌘5    │
     │   MIDI Monitor       ⌘6    │
     │ ✓ I/O Setup          ⌘7    │
     │ ──────────────────────────│
     │   Save Layout...           │
     │   Load Layout...           │
     │   Reset to Default         │
     └─────────────────────────────┘

  7. SAVED LAYOUTS
     ┌─────────────────────────────────────────┐
     │  PRESET LAYOUTS:                        │
     │                                         │
     │  [1] Browse & Edit                      │
     │      Database + Preview + Sequencer     │
     │                                         │
     │  [2] Performance                        │
     │      Sequencer + Mixer + Monitor        │
     │                                         │
     │  [3] Full Edit                          │
     │      All windows tiled                  │
     │                                         │
     │  [+] Save Current Layout...             │
     └─────────────────────────────────────────┘

  ---
  KEYBOARD SHORTCUTS

  | Action               | Shortcut |
  |----------------------|----------|
  | Show/Hide Database   | ⌘1       |
  | Show/Hide Sequencer  | ⌘2       |
  | Show/Hide MIDI Mixer | ⌘3       |
  | Show/Hide Piano Roll | ⌘4       |
  | Show/Hide CC Editor  | ⌘5       |
  | Show/Hide Monitor    | ⌘6       |
  | Show/Hide I/O Setup  | ⌘7       |
  | Minimize All         | ⌘M       |
  | Tile Windows         | ⌘T       |
  | Command Palette      | ⌘K       |
  | Play/Pause           | Space    |
  | Stop                 | Enter    |
  | Loop Toggle          | L        |
  | Mute Selected        | M        |
  | Solo Selected        | S        |

  ---
  Summary: What Changed

  | Before                   | After                                                            |
  |--------------------------|------------------------------------------------------------------|
  | Audio mixer with effects | MIDI mixer with transpose, velocity, pitch bend, quantize, swing |
  | Fixed panels             | Floating windows (drag, resize, snap, tab)                       |
  | Generic transport        | MIDI sync with clock source, external sync                       |
  | No I/O setup             | MIDI I/O window for outboard routing                             |
  | No monitor               | MIDI Monitor showing live data                                   |
  | Basic preview            | Preview with MIDI info (channels, notes, velocity range)         |

  Want me to start implementing any of these windows in the actual Svelte codebase?

  VIP3-STYLE DATABASE BROWSER FOR MIDI FILES

  ┌─ MIDI DATABASE ──────────────────────────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                                          │
  │  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
  │  │  🔍 Search patches...                                                               [⊗ Clear All] │ │
  │  └────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
  │                                                                                                          │
  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
  │  │                                                                                                      │
  │  │   FOLDER         INSTRUMENT      TIMBRE          STYLE           ARTICULATION      BPM              │
  │  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐          │
  │  │  │ ○ All     │  │ ○ All     │  │ ○ All     │  │ ○ All     │  │ ○ All     │  │ ○ All     │          │
  │  │  │───────────│  │───────────│  │───────────│  │───────────│  │───────────│  │───────────│          │
  │  │  │ ● Drums   │  │ ● Bass    │  │ ● Aggressive│ │ ○ Ambient │  │ ○ Arpeggio│  │ ○ 60-80   │          │
  │  │  │ ○ Bass    │  │ ○ Drums   │  │ ○ Airy    │  │ ● Cinematic│ │ ○ Chord   │  │ ● 80-100  │          │
  │  │  │ ○ Synth   │  │ ○ Guitar  │  │ ○ Bright  │  │ ○ Dance   │  │ ○ Fill    │  │ ○ 100-120 │          │
  │  │  │ ○ Keys    │  │ ○ Keys    │  │ ● Clean   │  │ ○ EDM     │  │ ● Loop    │  │ ○ 120-140 │          │
  │  │  │ ○ Strings │  │ ○ Organ   │  │ ○ Dark    │  │ ○ Funk    │  │ ○ Melody  │  │ ○ 140-160 │          │
  │  │  │ ○ Brass   │  │ ○ Pad     │  │ ○ Dirty   │  │ ○ Hip-Hop │  │ ○ One-Shot│  │ ○ 160-180 │          │
  │  │  │ ○ FX      │  │ ○ Pluck   │  │ ○ Distorted│ │ ○ House   │  │ ○ Phrase  │  │ ○ 180+    │          │
  │  │  │ ○ Loops   │  │ ○ Strings │  │ ○ Fat     │  │ ○ Jazz    │  │ ○ Riff    │  │           │          │
  │  │  │ ○ One-Shots│ │ ○ Synth   │  │ ○ Gritty  │  │ ○ Latin   │  │ ○ Stab    │  │───────────│          │
  │  │  │ ○ Projects│  │ ○ Vocal   │  │ ○ Hard    │  │ ○ Lo-Fi   │  │ ○ Sustain │  │ KEY       │          │
  │  │  │           │  │ ○ Wind    │  │ ○ Metallic│  │ ○ Metal   │  │           │  │───────────│          │
  │  │  │           │  │           │  │ ○ Muted   │  │ ○ Pop     │  │───────────│  │ ○ All     │          │
  │  │  │           │  │           │  │ ○ Punchy  │  │ ○ R&B     │  │ CHANNEL   │  │ ○ C Major │          │
  │  │  │           │  │           │  │ ○ Soft    │  │ ○ Reggae  │  │───────────│  │ ○ C Minor │          │
  │  │  │           │  │           │  │ ○ Thin    │  │ ○ Rock    │  │ ○ All     │  │ ○ D Major │          │
  │  │  │           │  │           │  │ ○ Warm    │  │ ○ Soul    │  │ ● Ch 1-8  │  │ ○ D Minor │          │
  │  │  │           │  │           │  │ ○ Wide    │  │ ○ Techno  │  │ ○ Ch 9    │  │ ○ E Major │          │
  │  │  │           │  │           │  │           │  │ ○ Trap    │  │ ● Ch 10   │  │ ...       │          │
  │  │  │           │  │           │  │           │  │           │  │ ○ Ch 11-16│  │           │          │
  │  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘          │
  │  │                                                                                                      │
  │  │  ACTIVE FILTERS: [Drums ×] [Clean ×] [Cinematic ×] [Loop ×] [80-100 BPM ×] [Ch 10 ×]               │
  │  │                                                                                                      │
  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────┘
  │                                                                                                          │
  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
  │  │                                                                                                      │
  │  │  RESULTS: 847 of 2,155,026 patches                              SORT: [Name ▼]  [★ Fav] [📅 Date]  │
  │  │                                                                                                      │
  │  │  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐ │
  │  │  │  ☆  808_cinematic_hit_C.mid                                                              ⋮    │ │
  │  │  │     Drums • Clean • Cinematic • One-Shot • Ch:10 • 92 BPM • C                                  │ │
  │  │  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  │  ★  cinematic_drum_build_01.mid                                                          ⋮    │ │
  │  │  │     Drums • Aggressive • Cinematic • Loop • Ch:10 • 88 BPM • -                                 │ │
  │  │  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  │  ☆  epic_snare_roll_A.mid                                                                ⋮    │ │
  │  │  │     Drums • Clean • Cinematic • Fill • Ch:10 • 96 BPM • A                                      │ │
  │  │  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  │  ★  hybrid_kick_pattern.mid                                                              ⋮    │ │
  │  │  │     Drums • Punchy • Cinematic • Loop • Ch:10 • 85 BPM • -                                     │ │
  │  │  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  │  ☆  tension_toms_ascending.mid                                                           ⋮    │ │
  │  │  │     Drums • Clean • Cinematic • Phrase • Ch:10 • 90 BPM • C                                    │ │
  │  │  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  │  ☆  trailer_hit_impact_01.mid                                                            ⋮    │ │
  │  │  │     Drums • Hard • Cinematic • One-Shot • Ch:10 • 80 BPM • -                                   │ │
  │  │  ├────────────────────────────────────────────────────────────────────────────────────────────────┤ │
  │  │  │  ★  war_drums_tribal_loop.mid                                                            ⋮    │ │
  │  │  │     Drums • Aggressive • Cinematic • Loop • Ch:10 • 95 BPM • D                                 │ │
  │  │  └────────────────────────────────────────────────────────────────────────────────────────────────┘ │
  │  │                                                                                                      │
  │  │                                        (scroll for more...)                                          │
  │  │                                                                                                      │
  │  │  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐ │
  │  │  │  ◄◄  ◄  Page [1] of 85  ►  ►►                             Show: [10 ▼] 25  50  100  500       │ │
  │  │  └────────────────────────────────────────────────────────────────────────────────────────────────┘ │
  │  │                                                                                                      │
  │  └──────────────────────────────────────────────────────────────────────────────────────────────────────┘
  │                                                                                                          │
  │  ═══════════════════════════════════════════════════════════════════════════════════════════════════════ │
  └──────────────────────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  VIP3-STYLE CATEGORY MAPPING (VST → MIDI)

  | VIP3 Category | MIDI Equivalent | Tags/Options                                                                                                                |
  |---------------|-----------------|-----------------------------------------------------------------------------------------------------------------------------|
  | Plugin        | Folder/Source   | User folders, Sample packs, Imports                                                                                         |
  | Instrument    | Instrument      | Bass, Drums, Keys, Synth, Strings, Guitar, Brass, Vocal, Pad, Pluck, FX                                                     |
  | Timbre        | Timbre          | Aggressive, Airy, Bright, Clean, Dark, Dirty, Distorted, Fat, Gritty, Hard, Metallic, Muted, Punchy, Soft, Thin, Warm, Wide |
  | Style         | Style/Genre     | Ambient, Cinematic, Dance, EDM, Funk, Hip-Hop, House, Jazz, Latin, Lo-Fi, Metal, Pop, R&B, Reggae, Rock, Soul, Techno, Trap |
  | Articulation  | Articulation    | Arpeggio, Chord, Fill, Loop, Melody, One-Shot, Phrase, Riff, Stab, Sustain                                                  |
  | (new)         | Channel         | 1-16, or grouped (Melodic 1-8, Drums 10, etc.)                                                                              |
  | (new)         | BPM             | Ranges: 60-80, 80-100, 100-120, 120-140, 140-160, 160-180, 180+                                                             |
  | (new)         | Key             | C, C#, D, D#, E, F, F#, G, G#, A, A#, B + Major/Minor                                                                       |

  ---
  DETAILED CATEGORY COLUMN COMPONENT

  ┌─ INSTRUMENT ─────────────┐
  │                          │
  │  ○ All (2,155,026)       │  ← Radio button shows count
  │  ─────────────────────── │
  │  ● Bass (245,891)        │  ← Selected = filled circle
  │  ○ Drums (523,456)       │  ← Unselected = empty circle
  │  ○ Guitar (89,234)       │
  │  ○ Keys (312,567)        │
  │  ○ Organ (45,123)        │
  │  ○ Pad (178,234)         │
  │  ○ Pluck (67,890)        │
  │  ○ Strings (156,789)     │
  │  ○ Synth (398,456)       │
  │  ○ Vocal (78,123)        │
  │  ○ Wind (34,567)         │
  │  ○ FX (24,696)           │
  │                          │
  │  [+ Add Custom...]       │  ← User can add tags
  │                          │
  └──────────────────────────┘
     ▲
     │ Scrollable if too many
     ▼

  ---
  MULTI-SELECT MODE (Like VIP3)

  VIP3 allows multiple selections within a category to broaden results. Same for MIDI:

  ┌─ TIMBRE ─────────────────┐
  │                          │
  │  ○ All                   │
  │  ─────────────────────── │
  │  ☑ Aggressive           │  ← Checkbox = multi-select
  │  ☐ Airy                 │
  │  ☐ Bright               │
  │  ☑ Clean                │  ← Multiple selected
  │  ☐ Dark                 │
  │  ☐ Dirty                │
  │  ☐ Distorted            │
  │  ☑ Punchy               │  ← Multiple selected
  │  ☐ Soft                 │
  │  ☐ Warm                 │
  │                          │
  └──────────────────────────┘

  Logic: (Aggressive OR Clean OR Punchy) AND [other category filters]

  ---
  RESULT ROW DETAIL

  ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
  │                                                                                                 │
  │  ☆  epic_bass_drop_C#m.mid                                                              ⋮     │
  │     Bass • Fat • Punchy • EDM • Trap • Drop • Ch:2 • 140 BPM • C# Minor                        │
  │                                                                                                 │
  │     │▓▓▓▓▓▓▓▓░░▓▓▓▓▓▓░░░░▓▓▓▓▓▓▓▓░░▓▓▓▓▓▓░░░░│  ← Mini piano roll preview (optional)        │
  │                                                                                                 │
  └─────────────────────────────────────────────────────────────────────────────────────────────────┘
     │
     ├── ☆/★ = Favorite toggle (click to toggle)
     │
     ├── Filename = primary identifier
     │
     ├── Tags = Instrument • Timbres • Style • Articulation • Channel • BPM • Key
     │
     ├── ⋮ = Context menu (Add to Project, Edit Tags, Show in Folder, Delete)
     │
     └── Mini preview = Optional waveform/piano roll thumbnail

  ---
  CONTEXT MENU (Right-click on result)

  ┌──────────────────────────────┐
  │ ▶ Preview                    │
  │ ─────────────────────────────│
  │ ➕ Add to Sequencer          │
  │ ➕ Add to Track 1 - Bass     │
  │ ➕ Add to Track 2 - Drums    │
  │ ─────────────────────────────│
  │ ★ Add to Favorites           │
  │ 🏷 Edit Tags...              │
  │ ─────────────────────────────│
  │ 📁 Show in Folder            │
  │ 📋 Copy Path                 │
  │ ─────────────────────────────│
  │ 🗑 Delete                    │
  └──────────────────────────────┘

  ---
  COMPLETE VIP3-STYLE LAYOUT WITH PREVIEW

  ┌─ MIDI DATABASE ──────────────────────────────────────────────────────────────────────────────────────────── [─][□][×] ─┐
  │  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
  │                                                                                                                          │
  │  ┌──────────────────────────────────────────────────────────────────────────────────────────────┐  ┌───────────────────┐ │
  │  │  🔍 Search...                                                                [⊗ Clear All] │  │  ≡ MENU           │ │
  │  └──────────────────────────────────────────────────────────────────────────────────────────────┘  └───────────────────┘ │
  │                                                                                                                          │
  │  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┬────────────┐
  │  │                                                                                                         │            │
  │  │   FOLDER       INSTRUMENT     TIMBRE         STYLE          ARTICULATION    BPM       KEY              │  PREVIEW   │
  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌───────┐  ┌───────┐                │            │
  │  │  │ ○ All   │  │ ○ All   │  │ ○ All   │  │ ○ All   │  │ ○ All   │  │ ○ All │  │ ○ All │                │ ┌────────┐ │
  │  │  │─────────│  │─────────│  │─────────│  │─────────│  │─────────│  │───────│  │───────│                │ │        │ │
  │  │  │ ● Drums │  │ ● Bass  │  │ ☑ Aggr  │  │ ○ Amb   │  │ ○ Arp   │  │ ○ 60  │  │ ○ C   │                │ │ PIANO  │ │
  │  │  │ ○ Bass  │  │ ○ Drums │  │ ☐ Airy  │  │ ● Cine  │  │ ☐ Chord │  │ ● 80  │  │ ○ C#  │                │ │  ROLL  │ │
  │  │  │ ○ Synth │  │ ○ Keys  │  │ ☐ Bright│  │ ○ Dance │  │ ☐ Fill  │  │ ○ 100 │  │ ○ D   │                │ │        │ │
  │  │  │ ○ Keys  │  │ ○ Synth │  │ ☑ Clean │  │ ○ EDM   │  │ ● Loop  │  │ ○ 120 │  │ ○ D#  │                │ │▓░▓░▓░▓░│ │
  │  │  │ ○ ...   │  │ ○ ...   │  │ ☐ Dark  │  │ ○ ...   │  │ ☐ ...   │  │ ○ ... │  │ ○ ... │                │ └────────┘ │
  │  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └───────┘  └───────┘                │            │
  │  │                                                                                                         │ File:      │
  │  │  ACTIVE: [Drums ×] [Aggressive ×] [Clean ×] [Cinematic ×] [Loop ×] [80-100 ×]                          │ 808_kick.  │
  │  │                                                                                                         │ mid        │
  │  ├─────────────────────────────────────────────────────────────────────────────────────────────────────────┤            │
  │  │                                                                                                         │ Ch: 10     │
  │  │  RESULTS: 847 patches                                                        SORT: [Name ▼] [★] [📅]  │ Notes: 24  │
  │  │                                                                                                         │ BPM: 128   │
  │  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────┐ │ Key: C     │
  │  │  │  ★  808_kick_pattern_01.mid                                                                   ⋮  │ │ Vel: 64-127│
  │  │  │     Drums • Punchy • Clean • Hip-Hop • Loop • Ch:10 • 92 BPM • C                                 │ │ Dur: 0:04  │
  │  │  ├───────────────────────────────────────────────────────────────────────────────────────────────────┤ │            │
  │  │  │  ☆  cinematic_snare_build.mid                                                                 ⋮  │ │ [▶ Play]   │
  │  │  │     Drums • Aggressive • Cinematic • Fill • Ch:10 • 88 BPM • -                                   │ │            │
  │  │  ├───────────────────────────────────────────────────────────────────────────────────────────────────┤ │ Tags:      │
  │  │  │  ☆  epic_tom_roll_ascending.mid                                                               ⋮  │ │ [drums]    │
  │  │  │     Drums • Clean • Cinematic • Phrase • Ch:10 • 96 BPM • A                                      │ │ [808]      │
  │  │  ├───────────────────────────────────────────────────────────────────────────────────────────────────┤ │ [kick]     │
  │  │  │  ★  hybrid_kick_trailer.mid                                                                   ⋮  │ │ [+ Add]    │
  │  │  │     Drums • Hard • Cinematic • One-Shot • Ch:10 • 85 BPM • -                                     │ │            │
  │  │  ├───────────────────────────────────────────────────────────────────────────────────────────────────┤ │ Similar:   │
  │  │  │  ☆  war_drums_tribal.mid                                                                      ⋮  │ │ ♪ 808_k... │
  │  │  │     Drums • Aggressive • Cinematic • Loop • Ch:10 • 95 BPM • D                                   │ │ ♪ tr808... │
  │  │  └───────────────────────────────────────────────────────────────────────────────────────────────────┘ │            │
  │  │                                                                                                         │ [➕ Add to │
  │  │  ◄◄  ◄  Page 1 of 85  ►  ►►                                              Show: [10 ▼]                 │  Sequencer]│
  │  │                                                                                                         │            │
  │  └─────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────┘
  │                                                                                                                          │
  │  ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════ │
  └──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  VIP3-STYLE MENU (≡)

  ┌─────────────────────────────┐
  │ ≡ MENU                      │
  ├─────────────────────────────┤
  │ Filter                    ► │──┐
  │ Sort by                   ► │  │  ┌────────────────────┐
  │ View                      ► │  ├──│ Show All           │
  │ ─────────────────────────── │  │  │ Show Favorites Only│
  │ Import MIDI Files...        │  │  │ Show Recent Only   │
  │ Scan Folders...             │  │  │ ──────────────────│
  │ ─────────────────────────── │  │  │ By Folder...     ► │
  │ Manage Tags...              │  │  └────────────────────┘
  │ Batch Tag Editor...         │  │
  │ ─────────────────────────── │  │
  │ Export Selection...         │  │
  │ ─────────────────────────── │  │
  │ Preferences...              │  │
  └─────────────────────────────┘  │
                                   │  ┌────────────────────┐
                                   ├──│ Name               │
                                   │  │ Date Added         │
                                   │  │ Date Modified      │
                                   │  │ BPM                │
                                   │  │ Key                │
                                   │  │ Duration           │
                                   │  │ Favorites First    │
                                   │  │ Rating             │
                                   │  └────────────────────┘
                                   │
                                   │  ┌────────────────────┐
                                   └──│ List View          │
                                      │ Grid View          │
                                      │ Compact View       │
                                      │ ──────────────────│
                                      │ Show Mini Preview  │
                                      │ Show Tags          │
                                      │ Show Path          │
                                      └────────────────────┘

  ---
  RATING SYSTEM (Like VIP3)

  ┌─────────────────────────────────────────────────────────────────────────────────────┐
  │  ★★★★☆  808_kick_pattern_01.mid                                                ⋮   │
  │         Drums • Punchy • Hip-Hop • Loop • Ch:10 • 92 BPM                            │
  └─────────────────────────────────────────────────────────────────────────────────────┘
       │
       └── Click stars to rate 1-5
           ★★★★★ = 5 stars (excellent)
           ★★★★☆ = 4 stars
           ★★★☆☆ = 3 stars
           ★★☆☆☆ = 2 stars
           ★☆☆☆☆ = 1 star
           ☆☆☆☆☆ = unrated

  ---
  FLOATING WINDOW IMPLEMENTATION APPROACH

  For Pro Tools-style floating/dockable windows in Svelte/Tauri:

  // WindowManager concept
  interface Window {
    id: string;
    title: string;
    component: SvelteComponent;
    position: { x: number; y: number };
    size: { width: number; height: number };
    state: 'normal' | 'minimized' | 'maximized';
    zIndex: number;
    docked: 'left' | 'right' | 'float' | 'tabbed';
    tabbedWith?: string; // ID of window tabbed with
  }

  // State stored in Svelte store
  const windows = writable<Window[]>([
    { id: 'database', title: 'MIDI Database', ... },
    { id: 'sequencer', title: 'Sequencer', ... },
    { id: 'mixer', title: 'MIDI Mixer', ... },
    { id: 'preview', title: 'Preview', ... },
  ]);

  ---
  SUMMARY: VIP3 → MIDI Software Center Mapping

  | VIP3 Feature            | MIDI Software Center Equivalent |
  |-------------------------|---------------------------------|
  | Plugin browser          | Folder/Source browser           |
  | Instrument category     | Instrument category (same)      |
  | Timbre tags             | Timbre tags (same)              |
  | Style tags              | Genre/Style tags (same)         |
  | Articulation tags       | Articulation tags (same)        |
  | Patch list              | MIDI file list                  |
  | Multi-select filtering  | Multi-select filtering (same)   |
  | Star ratings            | Star ratings (same)             |
  | Favorites               | Favorites (same)                |
  | Search field            | Search field (same)             |
  | Pagination              | Pagination (same)               |
  | Menu (≡)                | Menu (≡) with filter/sort/view  |
  | Clear filters button    | Clear filters button (⊗)        |
  | NEW: Channel filter     | Filter by MIDI channel 1-16     |
  | NEW: BPM filter         | Filter by tempo range           |
  | NEW: Key filter         | Filter by musical key           |
  | NEW: Piano roll preview | Visual preview of notes         |

  Sources:
  - https://www.akaipro.com/vip
  - https://manualmachine.com/akai/vipversion30/1182546-user-guide/
  - https://www.akaipro.com/press/vip-3-0-music-software-revolutionizes-the-creative-experience-for-universal-command-over-all-vsts-from-any-midi-controller.html

  ---
  Want me to start implementing the VIP3-style database browser component in your Svelte codebase?

  ● Great question! Let me design the optimal database schema to support the VIP3-style browser with all the filtering, tagging, and search capabilities.

  ---
  OPTIMAL MIDI DATABASE SCHEMA

  Core Philosophy

  1. Denormalize for speed - Duplicate common data for fast filtering
  2. Full-text search - PostgreSQL tsvector for instant search
  3. Tag system - Flexible many-to-many for user-defined tags
  4. Pre-computed stats - Store BPM, key, note count at import time
  5. Indexes on every filter column - Category columns need fast lookups

  ---
  DATABASE SCHEMA

  -- ============================================================================
  -- MIDI SOFTWARE CENTER - VIP3-STYLE DATABASE SCHEMA
  -- ============================================================================

  -- ----------------------------------------------------------------------------
  -- CORE TABLES
  -- ----------------------------------------------------------------------------

  -- Main MIDI files table
  CREATE TABLE midi_files (
      id              BIGSERIAL PRIMARY KEY,

      -- File identification
      file_hash       VARCHAR(64) NOT NULL UNIQUE,  -- SHA-256 for deduplication
      file_path       TEXT NOT NULL,                 -- Full path on disk
      file_name       VARCHAR(255) NOT NULL,         -- Just filename
      file_size       BIGINT NOT NULL,               -- Bytes

      -- MIDI metadata (extracted at import)
      format_type     SMALLINT,                      -- MIDI format 0, 1, or 2
      track_count     SMALLINT,                      -- Number of tracks
      ticks_per_beat  SMALLINT,                      -- Resolution (PPQ)
      duration_ms     INTEGER,                       -- Total length in milliseconds
      duration_beats  REAL,                          -- Total length in beats
      note_count      INTEGER,                       -- Total notes

      -- Primary MIDI channel (most notes on this channel)
      primary_channel SMALLINT,                      -- 1-16, NULL if multi-channel
      channels_used   SMALLINT[],                    -- Array of all channels used

      -- Musical analysis (computed at import)
      bpm             REAL,                          -- Detected tempo
      bpm_range_id    SMALLINT REFERENCES bpm_ranges(id),  -- For fast filtering
      time_signature  VARCHAR(10),                   -- "4/4", "3/4", "6/8", etc.
      key_signature   VARCHAR(10),                   -- "C", "Am", "F#m", etc.
      key_id          SMALLINT REFERENCES musical_keys(id), -- For fast filtering

      -- Velocity statistics
      velocity_min    SMALLINT,                      -- 0-127
      velocity_max    SMALLINT,                      -- 0-127
      velocity_avg    SMALLINT,                      -- Average velocity

      -- Note range
      note_low        SMALLINT,                      -- Lowest MIDI note (0-127)
      note_high       SMALLINT,                      -- Highest MIDI note (0-127)
      note_low_name   VARCHAR(10),                   -- "C-1", "G#4", etc.
      note_high_name  VARCHAR(10),                   -- Human-readable

      -- User data
      rating          SMALLINT DEFAULT 0,            -- 0-5 stars
      favorite        BOOLEAN DEFAULT FALSE,
      play_count      INTEGER DEFAULT 0,
      last_played_at  TIMESTAMPTZ,

      -- Categorization (denormalized for fast filtering)
      folder_id       BIGINT REFERENCES folders(id),
      instrument_id   SMALLINT REFERENCES instruments(id),

      -- Full-text search vector
      search_vector   TSVECTOR,

      -- Timestamps
      imported_at     TIMESTAMPTZ DEFAULT NOW(),
      modified_at     TIMESTAMPTZ DEFAULT NOW(),
      file_created_at TIMESTAMPTZ,                   -- From filesystem
      file_modified_at TIMESTAMPTZ,                  -- From filesystem

      -- Soft delete
      deleted_at      TIMESTAMPTZ
  );

  -- ----------------------------------------------------------------------------
  -- LOOKUP TABLES (for fast filtering dropdowns)
  -- ----------------------------------------------------------------------------

  -- Folders / Sources
  CREATE TABLE folders (
      id          BIGSERIAL PRIMARY KEY,
      parent_id   BIGINT REFERENCES folders(id),
      name        VARCHAR(255) NOT NULL,
      full_path   TEXT NOT NULL UNIQUE,
      file_count  INTEGER DEFAULT 0,               -- Denormalized count
      icon        VARCHAR(50),                     -- Optional custom icon
      color       VARCHAR(7),                      -- Hex color for UI
      sort_order  SMALLINT DEFAULT 0
  );

  -- Instruments (fixed list + user additions)
  CREATE TABLE instruments (
      id          SMALLSERIAL PRIMARY KEY,
      name        VARCHAR(50) NOT NULL UNIQUE,
      icon        VARCHAR(50),                     -- Emoji or icon name
      sort_order  SMALLINT DEFAULT 0,
      is_system   BOOLEAN DEFAULT FALSE,           -- TRUE = built-in, FALSE = user-added
      file_count  INTEGER DEFAULT 0                -- Denormalized count
  );

  -- Pre-populate instruments
  INSERT INTO instruments (name, icon, sort_order, is_system) VALUES
      ('Bass', '🎸', 1, TRUE),
      ('Drums', '🥁', 2, TRUE),
      ('Guitar', '🎸', 3, TRUE),
      ('Keys', '🎹', 4, TRUE),
      ('Organ', '🎹', 5, TRUE),
      ('Pad', '🎹', 6, TRUE),
      ('Pluck', '🎵', 7, TRUE),
      ('Strings', '🎻', 8, TRUE),
      ('Synth', '🎹', 9, TRUE),
      ('Vocal', '🎤', 10, TRUE),
      ('Wind', '🎷', 11, TRUE),
      ('Brass', '🎺', 12, TRUE),
      ('FX', '✨', 13, TRUE),
      ('Percussion', '🥁', 14, TRUE),
      ('Other', '🎵', 99, TRUE);

  -- Timbres (sound character)
  CREATE TABLE timbres (
      id          SMALLSERIAL PRIMARY KEY,
      name        VARCHAR(50) NOT NULL UNIQUE,
      sort_order  SMALLINT DEFAULT 0,
      is_system   BOOLEAN DEFAULT TRUE,
      file_count  INTEGER DEFAULT 0
  );

  INSERT INTO timbres (name, sort_order, is_system) VALUES
      ('Aggressive', 1, TRUE), ('Airy', 2, TRUE), ('Bright', 3, TRUE),
      ('Clean', 4, TRUE), ('Dark', 5, TRUE), ('Dirty', 6, TRUE),
      ('Distorted', 7, TRUE), ('Fat', 8, TRUE), ('Gritty', 9, TRUE),
      ('Hard', 10, TRUE), ('Metallic', 11, TRUE), ('Muted', 12, TRUE),
      ('Punchy', 13, TRUE), ('Soft', 14, TRUE), ('Thin', 15, TRUE),
      ('Warm', 16, TRUE), ('Wide', 17, TRUE), ('Analog', 18, TRUE),
      ('Digital', 19, TRUE), ('Organic', 20, TRUE), ('Synthetic', 21, TRUE);

  -- Styles / Genres
  CREATE TABLE styles (
      id          SMALLSERIAL PRIMARY KEY,
      name        VARCHAR(50) NOT NULL UNIQUE,
      sort_order  SMALLINT DEFAULT 0,
      is_system   BOOLEAN DEFAULT TRUE,
      file_count  INTEGER DEFAULT 0
  );

  INSERT INTO styles (name, sort_order, is_system) VALUES
      ('Ambient', 1, TRUE), ('Cinematic', 2, TRUE), ('Dance', 3, TRUE),
      ('EDM', 4, TRUE), ('Funk', 5, TRUE), ('Hip-Hop', 6, TRUE),
      ('House', 7, TRUE), ('Jazz', 8, TRUE), ('Latin', 9, TRUE),
      ('Lo-Fi', 10, TRUE), ('Metal', 11, TRUE), ('Pop', 12, TRUE),
      ('R&B', 13, TRUE), ('Reggae', 14, TRUE), ('Rock', 15, TRUE),
      ('Soul', 16, TRUE), ('Techno', 17, TRUE), ('Trap', 18, TRUE),
      ('Orchestral', 19, TRUE), ('Electronic', 20, TRUE), ('Acoustic', 21, TRUE),
      ('World', 22, TRUE), ('Experimental', 23, TRUE), ('Chillout', 24, TRUE);

  -- Articulations (how notes are played)
  CREATE TABLE articulations (
      id          SMALLSERIAL PRIMARY KEY,
      name        VARCHAR(50) NOT NULL UNIQUE,
      sort_order  SMALLINT DEFAULT 0,
      is_system   BOOLEAN DEFAULT TRUE,
      file_count  INTEGER DEFAULT 0
  );

  INSERT INTO articulations (name, sort_order, is_system) VALUES
      ('Arpeggio', 1, TRUE), ('Chord', 2, TRUE), ('Fill', 3, TRUE),
      ('Loop', 4, TRUE), ('Melody', 5, TRUE), ('One-Shot', 6, TRUE),
      ('Phrase', 7, TRUE), ('Riff', 8, TRUE), ('Stab', 9, TRUE),
      ('Sustain', 10, TRUE), ('Sequence', 11, TRUE), ('Pattern', 12, TRUE),
      ('Groove', 13, TRUE), ('Break', 14, TRUE), ('Intro', 15, TRUE),
      ('Outro', 16, TRUE), ('Verse', 17, TRUE), ('Chorus', 18, TRUE),
      ('Bridge', 19, TRUE), ('Drop', 20, TRUE);

  -- BPM Ranges (for fast filtering)
  CREATE TABLE bpm_ranges (
      id          SMALLSERIAL PRIMARY KEY,
      label       VARCHAR(20) NOT NULL,            -- "60-80", "80-100", etc.
      min_bpm     SMALLINT NOT NULL,
      max_bpm     SMALLINT NOT NULL,
      sort_order  SMALLINT
  );

  INSERT INTO bpm_ranges (label, min_bpm, max_bpm, sort_order) VALUES
      ('0-60', 0, 60, 1),
      ('60-80', 60, 80, 2),
      ('80-100', 80, 100, 3),
      ('100-120', 100, 120, 4),
      ('120-140', 120, 140, 5),
      ('140-160', 140, 160, 6),
      ('160-180', 160, 180, 7),
      ('180+', 180, 999, 8);

  -- Musical Keys
  CREATE TABLE musical_keys (
      id          SMALLSERIAL PRIMARY KEY,
      name        VARCHAR(10) NOT NULL UNIQUE,     -- "C", "C#", "Dm", "F#m"
      root_note   VARCHAR(2) NOT NULL,             -- "C", "C#", "D", etc.
      mode        VARCHAR(10) NOT NULL,            -- "Major", "Minor"
      sort_order  SMALLINT
  );

  INSERT INTO musical_keys (name, root_note, mode, sort_order) VALUES
      ('C', 'C', 'Major', 1), ('Cm', 'C', 'Minor', 2),
      ('C#', 'C#', 'Major', 3), ('C#m', 'C#', 'Minor', 4),
      ('D', 'D', 'Major', 5), ('Dm', 'D', 'Minor', 6),
      ('D#', 'D#', 'Major', 7), ('D#m', 'D#', 'Minor', 8),
      ('E', 'E', 'Major', 9), ('Em', 'E', 'Minor', 10),
      ('F', 'F', 'Major', 11), ('Fm', 'F', 'Minor', 12),
      ('F#', 'F#', 'Major', 13), ('F#m', 'F#', 'Minor', 14),
      ('G', 'G', 'Major', 15), ('Gm', 'G', 'Minor', 16),
      ('G#', 'G#', 'Major', 17), ('G#m', 'G#', 'Minor', 18),
      ('A', 'A', 'Major', 19), ('Am', 'A', 'Minor', 20),
      ('A#', 'A#', 'Major', 21), ('A#m', 'A#', 'Minor', 22),
      ('B', 'B', 'Major', 23), ('Bm', 'B', 'Minor', 24);

  -- ----------------------------------------------------------------------------
  -- MANY-TO-MANY TAG RELATIONSHIPS
  -- ----------------------------------------------------------------------------

  -- File <-> Timbre (many-to-many)
  CREATE TABLE midi_file_timbres (
      midi_file_id    BIGINT REFERENCES midi_files(id) ON DELETE CASCADE,
      timbre_id       SMALLINT REFERENCES timbres(id) ON DELETE CASCADE,
      PRIMARY KEY (midi_file_id, timbre_id)
  );

  -- File <-> Style (many-to-many)
  CREATE TABLE midi_file_styles (
      midi_file_id    BIGINT REFERENCES midi_files(id) ON DELETE CASCADE,
      style_id        SMALLINT REFERENCES styles(id) ON DELETE CASCADE,
      PRIMARY KEY (midi_file_id, style_id)
  );

  -- File <-> Articulation (many-to-many)
  CREATE TABLE midi_file_articulations (
      midi_file_id        BIGINT REFERENCES midi_files(id) ON DELETE CASCADE,
      articulation_id     SMALLINT REFERENCES articulations(id) ON DELETE CASCADE,
      PRIMARY KEY (midi_file_id, articulation_id)
  );

  -- Custom user tags (freeform)
  CREATE TABLE tags (
      id          BIGSERIAL PRIMARY KEY,
      name        VARCHAR(100) NOT NULL UNIQUE,
      color       VARCHAR(7),                      -- Hex color
      file_count  INTEGER DEFAULT 0
  );

  CREATE TABLE midi_file_tags (
      midi_file_id    BIGINT REFERENCES midi_files(id) ON DELETE CASCADE,
      tag_id          BIGINT REFERENCES tags(id) ON DELETE CASCADE,
      PRIMARY KEY (midi_file_id, tag_id)
  );

  -- ----------------------------------------------------------------------------
  -- USER DATA TABLES
  -- ----------------------------------------------------------------------------

  -- Saved searches (like VIP3)
  CREATE TABLE saved_searches (
      id          BIGSERIAL PRIMARY KEY,
      name        VARCHAR(100) NOT NULL,
      filters     JSONB NOT NULL,                  -- Store filter state as JSON
      sort_by     VARCHAR(50),
      sort_order  VARCHAR(4),                      -- 'asc' or 'desc'
      created_at  TIMESTAMPTZ DEFAULT NOW(),
      last_used   TIMESTAMPTZ,
      use_count   INTEGER DEFAULT 0
  );

  -- Recent searches
  CREATE TABLE recent_searches (
      id          BIGSERIAL PRIMARY KEY,
      query       TEXT NOT NULL,
      filters     JSONB,
      searched_at TIMESTAMPTZ DEFAULT NOW()
  );

  -- Collections / Playlists
  CREATE TABLE collections (
      id          BIGSERIAL PRIMARY KEY,
      name        VARCHAR(100) NOT NULL,
      description TEXT,
      icon        VARCHAR(50),
      color       VARCHAR(7),
      created_at  TIMESTAMPTZ DEFAULT NOW(),
      modified_at TIMESTAMPTZ DEFAULT NOW()
  );

  CREATE TABLE collection_files (
      collection_id   BIGINT REFERENCES collections(id) ON DELETE CASCADE,
      midi_file_id    BIGINT REFERENCES midi_files(id) ON DELETE CASCADE,
      sort_order      INTEGER,
      added_at        TIMESTAMPTZ DEFAULT NOW(),
      PRIMARY KEY (collection_id, midi_file_id)
  );

  -- ----------------------------------------------------------------------------
  -- INDEXES FOR FAST FILTERING
  -- ----------------------------------------------------------------------------

  -- Primary filters (each category column needs an index)
  CREATE INDEX idx_midi_files_folder ON midi_files(folder_id) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_instrument ON midi_files(instrument_id) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_bpm_range ON midi_files(bpm_range_id) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_key ON midi_files(key_id) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_channel ON midi_files(primary_channel) WHERE deleted_at IS NULL;

  -- User data filters
  CREATE INDEX idx_midi_files_favorite ON midi_files(favorite) WHERE favorite = TRUE AND deleted_at IS NULL;
  CREATE INDEX idx_midi_files_rating ON midi_files(rating) WHERE rating > 0 AND deleted_at IS NULL;

  -- Sorting indexes
  CREATE INDEX idx_midi_files_name ON midi_files(file_name) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_imported ON midi_files(imported_at DESC) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_modified ON midi_files(modified_at DESC) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_bpm ON midi_files(bpm) WHERE deleted_at IS NULL;
  CREATE INDEX idx_midi_files_duration ON midi_files(duration_ms) WHERE deleted_at IS NULL;

  -- Full-text search index
  CREATE INDEX idx_midi_files_search ON midi_files USING GIN(search_vector);

  -- Many-to-many indexes
  CREATE INDEX idx_file_timbres_file ON midi_file_timbres(midi_file_id);
  CREATE INDEX idx_file_timbres_timbre ON midi_file_timbres(timbre_id);
  CREATE INDEX idx_file_styles_file ON midi_file_styles(midi_file_id);
  CREATE INDEX idx_file_styles_style ON midi_file_styles(style_id);
  CREATE INDEX idx_file_articulations_file ON midi_file_articulations(midi_file_id);
  CREATE INDEX idx_file_articulations_articulation ON midi_file_articulations(articulation_id);
  CREATE INDEX idx_file_tags_file ON midi_file_tags(midi_file_id);
  CREATE INDEX idx_file_tags_tag ON midi_file_tags(tag_id);

  -- Composite index for common filter combinations
  CREATE INDEX idx_midi_files_common_filter ON midi_files(instrument_id, bpm_range_id, key_id)
      WHERE deleted_at IS NULL;

  -- ----------------------------------------------------------------------------
  -- FUNCTIONS & TRIGGERS
  -- ----------------------------------------------------------------------------

  -- Auto-update search vector on insert/update
  CREATE OR REPLACE FUNCTION update_midi_search_vector()
  RETURNS TRIGGER AS $$
  BEGIN
      NEW.search_vector :=
          setweight(to_tsvector('english', COALESCE(NEW.file_name, '')), 'A') ||
          setweight(to_tsvector('english', COALESCE(
              (SELECT name FROM instruments WHERE id = NEW.instrument_id), ''
          )), 'B') ||
          setweight(to_tsvector('english', COALESCE(NEW.key_signature, '')), 'C');
      RETURN NEW;
  END;
  $$ LANGUAGE plpgsql;

  CREATE TRIGGER midi_files_search_vector_update
      BEFORE INSERT OR UPDATE ON midi_files
      FOR EACH ROW EXECUTE FUNCTION update_midi_search_vector();

  -- Update folder file counts
  CREATE OR REPLACE FUNCTION update_folder_counts()
  RETURNS TRIGGER AS $$
  BEGIN
      IF TG_OP = 'INSERT' THEN
          UPDATE folders SET file_count = file_count + 1 WHERE id = NEW.folder_id;
      ELSIF TG_OP = 'DELETE' THEN
          UPDATE folders SET file_count = file_count - 1 WHERE id = OLD.folder_id;
      ELSIF TG_OP = 'UPDATE' AND OLD.folder_id != NEW.folder_id THEN
          UPDATE folders SET file_count = file_count - 1 WHERE id = OLD.folder_id;
          UPDATE folders SET file_count = file_count + 1 WHERE id = NEW.folder_id;
      END IF;
      RETURN NULL;
  END;
  $$ LANGUAGE plpgsql;

  CREATE TRIGGER midi_files_folder_count
      AFTER INSERT OR DELETE OR UPDATE OF folder_id ON midi_files
      FOR EACH ROW EXECUTE FUNCTION update_folder_counts();

  -- Auto-assign BPM range based on BPM value
  CREATE OR REPLACE FUNCTION assign_bpm_range()
  RETURNS TRIGGER AS $$
  BEGIN
      IF NEW.bpm IS NOT NULL THEN
          SELECT id INTO NEW.bpm_range_id
          FROM bpm_ranges
          WHERE NEW.bpm >= min_bpm AND NEW.bpm < max_bpm
          LIMIT 1;
      END IF;
      RETURN NEW;
  END;
  $$ LANGUAGE plpgsql;

  CREATE TRIGGER midi_files_bpm_range_assign
      BEFORE INSERT OR UPDATE OF bpm ON midi_files
      FOR EACH ROW EXECUTE FUNCTION assign_bpm_range();

  -- ----------------------------------------------------------------------------
  -- VIEWS FOR COMMON QUERIES
  -- ----------------------------------------------------------------------------

  -- View with all tags aggregated (for display)
  CREATE VIEW midi_files_with_tags AS
  SELECT
      f.*,
      i.name AS instrument_name,
      fo.name AS folder_name,
      k.name AS key_name,
      br.label AS bpm_range_label,
      COALESCE(
          (SELECT array_agg(t.name ORDER BY t.sort_order)
           FROM midi_file_timbres ft
           JOIN timbres t ON ft.timbre_id = t.id
           WHERE ft.midi_file_id = f.id),
          '{}'
      ) AS timbres,
      COALESCE(
          (SELECT array_agg(s.name ORDER BY s.sort_order)
           FROM midi_file_styles fs
           JOIN styles s ON fs.style_id = s.id
           WHERE fs.midi_file_id = f.id),
          '{}'
      ) AS styles,
      COALESCE(
          (SELECT array_agg(a.name ORDER BY a.sort_order)
           FROM midi_file_articulations fa
           JOIN articulations a ON fa.articulation_id = a.id
           WHERE fa.midi_file_id = f.id),
          '{}'
      ) AS articulations,
      COALESCE(
          (SELECT array_agg(t.name)
           FROM midi_file_tags ft
           JOIN tags t ON ft.tag_id = t.id
           WHERE ft.midi_file_id = f.id),
          '{}'
      ) AS custom_tags
  FROM midi_files f
  LEFT JOIN instruments i ON f.instrument_id = i.id
  LEFT JOIN folders fo ON f.folder_id = fo.id
  LEFT JOIN musical_keys k ON f.key_id = k.id
  LEFT JOIN bpm_ranges br ON f.bpm_range_id = br.id
  WHERE f.deleted_at IS NULL;

  -- Category counts view (for sidebar numbers)
  CREATE VIEW category_counts AS
  SELECT
      'instrument' AS category,
      i.id,
      i.name,
      i.icon,
      i.sort_order,
      COUNT(f.id) AS file_count
  FROM instruments i
  LEFT JOIN midi_files f ON f.instrument_id = i.id AND f.deleted_at IS NULL
  GROUP BY i.id
  UNION ALL
  SELECT
      'bpm_range' AS category,
      br.id,
      br.label AS name,
      NULL AS icon,
      br.sort_order,
      COUNT(f.id) AS file_count
  FROM bpm_ranges br
  LEFT JOIN midi_files f ON f.bpm_range_id = br.id AND f.deleted_at IS NULL
  GROUP BY br.id
  ORDER BY category, sort_order;

  ---
  OPTIMIZED QUERY FOR VIP3-STYLE FILTERING

  -- Example: Filter by Drums + Clean + Punchy + Cinematic + Loop + 80-100 BPM + Ch 10
  -- This is the query that runs when user clicks multiple filter tags

  WITH filtered_files AS (
      SELECT DISTINCT f.id
      FROM midi_files f
      -- Filter by instrument (single select)
      WHERE f.instrument_id = (SELECT id FROM instruments WHERE name = 'Drums')
      -- Filter by BPM range
      AND f.bpm_range_id = (SELECT id FROM bpm_ranges WHERE label = '80-100')
      -- Filter by channel
      AND f.primary_channel = 10
      -- Filter by timbres (multi-select: Clean OR Punchy)
      AND f.id IN (
          SELECT midi_file_id FROM midi_file_timbres
          WHERE timbre_id IN (SELECT id FROM timbres WHERE name IN ('Clean', 'Punchy'))
      )
      -- Filter by styles (multi-select)
      AND f.id IN (
          SELECT midi_file_id FROM midi_file_styles
          WHERE style_id = (SELECT id FROM styles WHERE name = 'Cinematic')
      )
      -- Filter by articulations (multi-select)
      AND f.id IN (
          SELECT midi_file_id FROM midi_file_articulations
          WHERE articulation_id = (SELECT id FROM articulations WHERE name = 'Loop')
      )
      -- Not deleted
      AND f.deleted_at IS NULL
  )
  SELECT
      f.id,
      f.file_name,
      f.file_path,
      f.bpm,
      f.key_signature,
      f.primary_channel,
      f.duration_ms,
      f.note_count,
      f.rating,
      f.favorite,
      i.name AS instrument,
      array_agg(DISTINCT t.name) AS timbres,
      array_agg(DISTINCT s.name) AS styles,
      array_agg(DISTINCT a.name) AS articulations
  FROM midi_files f
  JOIN filtered_files ff ON f.id = ff.id
  LEFT JOIN instruments i ON f.instrument_id = i.id
  LEFT JOIN midi_file_timbres ft ON f.id = ft.midi_file_id
  LEFT JOIN timbres t ON ft.timbre_id = t.id
  LEFT JOIN midi_file_styles fs ON f.id = fs.midi_file_id
  LEFT JOIN styles s ON fs.style_id = s.id
  LEFT JOIN midi_file_articulations fa ON f.id = fa.midi_file_id
  LEFT JOIN articulations a ON fa.articulation_id = a.id
  GROUP BY f.id, i.name
  ORDER BY f.file_name
  LIMIT 25 OFFSET 0;

  ---
  FULL-TEXT SEARCH QUERY

  -- Search "808 kick cinematic"
  SELECT
      f.id,
      f.file_name,
      f.rating,
      ts_rank(f.search_vector, query) AS rank
  FROM midi_files f,
       plainto_tsquery('english', '808 kick cinematic') query
  WHERE f.search_vector @@ query
    AND f.deleted_at IS NULL
  ORDER BY rank DESC, f.rating DESC
  LIMIT 25;

  ---
  RUST STRUCT MAPPING

  // src/database/models/midi_file.rs

  use sqlx::FromRow;
  use chrono::{DateTime, Utc};

  #[derive(Debug, Clone, FromRow)]
  pub struct MidiFile {
      pub id: i64,
      pub file_hash: String,
      pub file_path: String,
      pub file_name: String,
      pub file_size: i64,

      // MIDI metadata
      pub format_type: Option<i16>,
      pub track_count: Option<i16>,
      pub ticks_per_beat: Option<i16>,
      pub duration_ms: Option<i32>,
      pub duration_beats: Option<f32>,
      pub note_count: Option<i32>,

      // Channel info
      pub primary_channel: Option<i16>,
      pub channels_used: Option<Vec<i16>>,

      // Musical analysis
      pub bpm: Option<f32>,
      pub bpm_range_id: Option<i16>,
      pub time_signature: Option<String>,
      pub key_signature: Option<String>,
      pub key_id: Option<i16>,

      // Velocity
      pub velocity_min: Option<i16>,
      pub velocity_max: Option<i16>,
      pub velocity_avg: Option<i16>,

      // Note range
      pub note_low: Option<i16>,
      pub note_high: Option<i16>,
      pub note_low_name: Option<String>,
      pub note_high_name: Option<String>,

      // User data
      pub rating: i16,
      pub favorite: bool,
      pub play_count: i32,
      pub last_played_at: Option<DateTime<Utc>>,

      // Foreign keys
      pub folder_id: Option<i64>,
      pub instrument_id: Option<i16>,

      // Timestamps
      pub imported_at: DateTime<Utc>,
      pub modified_at: DateTime<Utc>,
  }

  // For VIP3-style list display
  #[derive(Debug, Clone)]
  pub struct MidiFileListItem {
      pub id: i64,
      pub file_name: String,
      pub file_path: String,
      pub bpm: Option<f32>,
      pub key_signature: Option<String>,
      pub primary_channel: Option<i16>,
      pub duration_ms: Option<i32>,
      pub rating: i16,
      pub favorite: bool,

      // Denormalized for display
      pub instrument: Option<String>,
      pub timbres: Vec<String>,
      pub styles: Vec<String>,
      pub articulations: Vec<String>,
  }

  // Filter state (matches saved_searches.filters JSONB)
  #[derive(Debug, Clone, Serialize, Deserialize)]
  pub struct BrowserFilters {
      pub folder_ids: Vec<i64>,
      pub instrument_ids: Vec<i16>,
      pub timbre_ids: Vec<i16>,
      pub style_ids: Vec<i16>,
      pub articulation_ids: Vec<i16>,
      pub bpm_range_ids: Vec<i16>,
      pub key_ids: Vec<i16>,
      pub channels: Vec<i16>,
      pub favorites_only: bool,
      pub min_rating: Option<i16>,
      pub search_query: Option<String>,
  }

  impl Default for BrowserFilters {
      fn default() -> Self {
          Self {
              folder_ids: vec![],
              instrument_ids: vec![],
              timbre_ids: vec![],
              style_ids: vec![],
              articulation_ids: vec![],
              bpm_range_ids: vec![],
              key_ids: vec![],
              channels: vec![],
              favorites_only: false,
              min_rating: None,
              search_query: None,
          }
      }
  }

  ---
  IMPORT PIPELINE - MIDI ANALYSIS

  When importing MIDI files, extract all metadata:

  // src/import/midi_analyzer.rs

  use midly::{Smf, TrackEventKind, MidiMessage};
  use std::collections::HashMap;

  pub struct MidiAnalysis {
      pub format_type: u8,
      pub track_count: u16,
      pub ticks_per_beat: u16,
      pub duration_ms: u32,
      pub duration_beats: f32,
      pub note_count: u32,
      pub primary_channel: Option<u8>,
      pub channels_used: Vec<u8>,
      pub bpm: Option<f32>,
      pub time_signature: String,
      pub key_signature: Option<String>,
      pub velocity_min: u8,
      pub velocity_max: u8,
      pub velocity_avg: u8,
      pub note_low: u8,
      pub note_high: u8,
  }

  pub fn analyze_midi(data: &[u8]) -> Result<MidiAnalysis, midly::Error> {
      let smf = Smf::parse(data)?;

      let mut note_count = 0u32;
      let mut channel_notes: HashMap<u8, u32> = HashMap::new();
      let mut velocities: Vec<u8> = Vec::new();
      let mut notes: Vec<u8> = Vec::new();
      let mut tempo = 500_000u32; // Default 120 BPM
      let mut time_sig = "4/4".to_string();

      for track in &smf.tracks {
          for event in track {
              match event.kind {
                  TrackEventKind::Midi { channel, message } => {
                      match message {
                          MidiMessage::NoteOn { key, vel } if vel > 0 => {
                              note_count += 1;
                              *channel_notes.entry(channel.as_int()).or_default() += 1;
                              velocities.push(vel.as_int());
                              notes.push(key.as_int());
                          }
                          _ => {}
                      }
                  }
                  TrackEventKind::Meta(meta) => {
                      match meta {
                          midly::MetaMessage::Tempo(t) => tempo = t.as_int(),
                          midly::MetaMessage::TimeSignature(num, den, _, _) => {
                              time_sig = format!("{}/{}", num, 2u8.pow(den as u32));
                          }
                          midly::MetaMessage::KeySignature(sf, minor) => {
                              // Convert to key name...
                          }
                          _ => {}
                      }
                  }
                  _ => {}
              }
          }
      }

      // Find primary channel (most notes)
      let primary_channel = channel_notes
          .iter()
          .max_by_key(|(_, count)| *count)
          .map(|(ch, _)| *ch);

      let channels_used: Vec<u8> = channel_notes.keys().copied().collect();

      let bpm = 60_000_000.0 / tempo as f32;

      Ok(MidiAnalysis {
          format_type: match smf.header.format {
              midly::Format::SingleTrack => 0,
              midly::Format::Parallel => 1,
              midly::Format::Sequential => 2,
          },
          track_count: smf.tracks.len() as u16,
          ticks_per_beat: match smf.header.timing {
              midly::Timing::Metrical(ppq) => ppq.as_int(),
              _ => 480,
          },
          duration_ms: 0, // Calculate from total ticks
          duration_beats: 0.0,
          note_count,
          primary_channel,
          channels_used,
          bpm: Some(bpm),
          time_signature: time_sig,
          key_signature: None, // From meta event
          velocity_min: velocities.iter().min().copied().unwrap_or(0),
          velocity_max: velocities.iter().max().copied().unwrap_or(127),
          velocity_avg: if velocities.is_empty() { 0 } else {
              (velocities.iter().map(|v| *v as u32).sum::<u32>() / velocities.len() as u32) as u8
          },
          note_low: notes.iter().min().copied().unwrap_or(0),
          note_high: notes.iter().max().copied().unwrap_or(127),
      })
  }

  ---
  AUTO-TAGGING SUGGESTIONS

  Use filename patterns to suggest tags:

  // src/import/auto_tagger.rs

  use regex::Regex;
  use lazy_static::lazy_static;

  lazy_static! {
      // Instrument patterns
      static ref BASS_RE: Regex = Regex::new(r"(?i)\b(bass|sub|808|low)\b").unwrap();
      static ref DRUMS_RE: Regex = Regex::new(r"(?i)\b(drum|kick|snare|hihat|hi-hat|hat|tom|cymbal|perc)\b").unwrap();
      static ref KEYS_RE: Regex = Regex::new(r"(?i)\b(piano|keys|keyboard|rhodes|wurli|clav)\b").unwrap();
      static ref SYNTH_RE: Regex = Regex::new(r"(?i)\b(synth|lead|pad|arp|seq)\b").unwrap();

      // Style patterns
      static ref HIPHOP_RE: Regex = Regex::new(r"(?i)\b(hip.?hop|hiphop|trap|boom.?bap|rap)\b").unwrap();
      static ref EDM_RE: Regex = Regex::new(r"(?i)\b(edm|house|techno|trance|dubstep|dnb|drum.?n.?bass)\b").unwrap();
      static ref CINEMATIC_RE: Regex = Regex::new(r"(?i)\b(cinema|epic|trailer|score|orchestr|film)\b").unwrap();

      // Articulation patterns
      static ref LOOP_RE: Regex = Regex::new(r"(?i)\b(loop|lp|pattern)\b").unwrap();
      static ref ONESHOT_RE: Regex = Regex::new(r"(?i)\b(one.?shot|hit|stab|single)\b").unwrap();
      static ref FILL_RE: Regex = Regex::new(r"(?i)\b(fill|break|transition)\b").unwrap();

      // BPM extraction
      static ref BPM_RE: Regex = Regex::new(r"(?i)(\d{2,3})\s*bpm").unwrap();

      // Key extraction
      static ref KEY_RE: Regex = Regex::new(r"(?i)\b([A-G][#b]?)\s*(maj|min|m|major|minor)?\b").unwrap();
  }

  pub struct AutoTagSuggestions {
      pub instrument: Option<&'static str>,
      pub styles: Vec<&'static str>,
      pub articulations: Vec<&'static str>,
      pub timbres: Vec<&'static str>,
      pub bpm: Option<f32>,
      pub key: Option<String>,
  }

  pub fn suggest_tags(filename: &str, folder_path: &str) -> AutoTagSuggestions {
      let combined = format!("{} {}", filename, folder_path);

      let instrument = if DRUMS_RE.is_match(&combined) {
          Some("Drums")
      } else if BASS_RE.is_match(&combined) {
          Some("Bass")
      } else if KEYS_RE.is_match(&combined) {
          Some("Keys")
      } else if SYNTH_RE.is_match(&combined) {
          Some("Synth")
      } else {
          None
      };

      let mut styles = Vec::new();
      if HIPHOP_RE.is_match(&combined) { styles.push("Hip-Hop"); }
      if EDM_RE.is_match(&combined) { styles.push("EDM"); }
      if CINEMATIC_RE.is_match(&combined) { styles.push("Cinematic"); }

      let mut articulations = Vec::new();
      if LOOP_RE.is_match(&combined) { articulations.push("Loop"); }
      if ONESHOT_RE.is_match(&combined) { articulations.push("One-Shot"); }
      if FILL_RE.is_match(&combined) { articulations.push("Fill"); }

      let bpm = BPM_RE.captures(&combined)
          .and_then(|c| c.get(1))
          .and_then(|m| m.as_str().parse().ok());

      let key = KEY_RE.captures(&combined)
          .map(|c| {
              let root = c.get(1).map(|m| m.as_str()).unwrap_or("");
              let mode = c.get(2).map(|m| m.as_str()).unwrap_or("");
              if mode.to_lowercase().starts_with("m") && mode.len() <= 3 {
                  format!("{}m", root)
              } else {
                  root.to_string()
              }
          });

      AutoTagSuggestions {
          instrument,
          styles,
          articulations,
          timbres: vec![], // Harder to detect from filename
          bpm,
          key,
      }
  }

  ---
  SUMMARY: DATABASE DESIGN FOR VIP3-STYLE BROWSER

  | Requirement                | Solution                                                                                         |
  |----------------------------|--------------------------------------------------------------------------------------------------|
  | 7 filter columns           | Dedicated tables: folders, instruments, timbres, styles, articulations, bpm_ranges, musical_keys |
  | Multi-select within column | Many-to-many join tables (midi_file_timbres, etc.)                                               |
  | Fast filtering             | Indexes on every filter column + composite index                                                 |
  | Instant search             | PostgreSQL tsvector with GIN index                                                               |
  | File counts per tag        | Denormalized file_count column + triggers                                                        |
  | Ratings & favorites        | rating (0-5) and favorite (bool) columns                                                         |
  | Pagination                 | Standard LIMIT/OFFSET with indexed ORDER BY                                                      |
  | Saved searches             | saved_searches table with JSONB filters                                                          |
  | Auto-tagging               | Regex patterns on filename + MIDI analysis                                                       |
  | Deduplication              | SHA-256 file_hash with UNIQUE constraint                                                         |

  This schema supports:
  - 2M+ files with sub-100ms filtering
  - VIP3-identical category column layout
  - Multi-select any combination of tags
  - Full-text search across filename + tags
  - Pre-computed BPM, key, channel, note stats at import

  Want me to create the migration files and implement this in the MIDI Software Center codebase?

    COMPLETE DATA MODEL FOR MIDI SOFTWARE CENTER

  ┌─────────────────────────────────────────────────────────────────────────────────────────┐
  │                           MIDI SOFTWARE CENTER - DATA DOMAINS                            │
  ├─────────────────────────────────────────────────────────────────────────────────────────┤
  │                                                                                          │
  │   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                │
  │   │   1. MIDI   │   │ 2. PROJECTS │   │  3. MIXER   │   │  4. MIDI    │                │
  │   │   FILES     │   │  /SESSIONS  │   │   STATE     │   │    I/O      │                │
  │   │  (Library)  │   │  (Sequencer)│   │  (Params)   │   │  (Routing)  │                │
  │   └─────────────┘   └─────────────┘   └─────────────┘   └─────────────┘                │
  │                                                                                          │
  │   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                │
  │   │ 5. USER     │   │ 6. OUTBOARD │   │ 7. PRESETS  │   │ 8. HISTORY  │                │
  │   │ PREFERENCES │   │    GEAR     │   │ /TEMPLATES  │   │   & UNDO    │                │
  │   │ (Settings)  │   │  (Hardware) │   │  (Reusable) │   │   (Audit)   │                │
  │   └─────────────┘   └─────────────┘   └─────────────┘   └─────────────┘                │
  │                                                                                          │
  └─────────────────────────────────────────────────────────────────────────────────────────┘

  ---
  1. MIDI FILES DATABASE (Already Designed)

  Purpose: Library of all imported MIDI files with tags, metadata, search

  | Table                                       | Purpose                                  |
  |---------------------------------------------|------------------------------------------|
  | midi_files                                  | Core file records with analyzed metadata |
  | folders                                     | Source folder hierarchy                  |
  | instruments, timbres, styles, articulations | Category tags                            |
  | midi_file_*                                 | Many-to-many tag relationships           |
  | tags                                        | Custom user-defined tags                 |
  | saved_searches, collections                 | User organization                        |

  ---
  2. PROJECTS / SESSIONS (Sequencer Data)

  Purpose: Save and load complete arrangements

  -- ============================================================================
  -- PROJECTS / SESSIONS
  -- ============================================================================

  -- A project is a complete arrangement (like a DAW project file)
  CREATE TABLE projects (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(255) NOT NULL,
      description     TEXT,

      -- Project settings
      bpm             REAL NOT NULL DEFAULT 120.0,
      time_signature  VARCHAR(10) DEFAULT '4/4',

      -- Timeline
      length_bars     INTEGER DEFAULT 16,
      loop_start_bar  INTEGER DEFAULT 1,
      loop_end_bar    INTEGER DEFAULT 8,
      loop_enabled    BOOLEAN DEFAULT FALSE,

      -- Playback position (for resume)
      playhead_ticks  BIGINT DEFAULT 0,

      -- Sync settings
      sync_source     VARCHAR(20) DEFAULT 'internal',  -- internal, external, midi_clock
      send_midi_clock BOOLEAN DEFAULT TRUE,

      -- File path (if saved to disk as .msc file)
      file_path       TEXT,

      -- Metadata
      created_at      TIMESTAMPTZ DEFAULT NOW(),
      modified_at     TIMESTAMPTZ DEFAULT NOW(),
      last_opened_at  TIMESTAMPTZ,

      -- Soft delete
      archived_at     TIMESTAMPTZ
  );

  -- Tracks within a project
  CREATE TABLE project_tracks (
      id              BIGSERIAL PRIMARY KEY,
      project_id      BIGINT NOT NULL REFERENCES projects(id) ON DELETE CASCADE,

      -- Track info
      name            VARCHAR(100) NOT NULL,
      color           VARCHAR(7),                      -- Hex color
      icon            VARCHAR(50),
      sort_order      SMALLINT NOT NULL,

      -- Track state
      muted           BOOLEAN DEFAULT FALSE,
      solo            BOOLEAN DEFAULT FALSE,
      armed           BOOLEAN DEFAULT FALSE,           -- For recording
      collapsed       BOOLEAN DEFAULT FALSE,           -- UI state
      height          SMALLINT DEFAULT 80,             -- Track height in pixels

      -- MIDI routing
      midi_channel    SMALLINT NOT NULL DEFAULT 1,     -- 1-16
      midi_port_id    BIGINT REFERENCES midi_ports(id),

      -- Track-level MIDI transforms (from mixer)
      transpose       SMALLINT DEFAULT 0,              -- -24 to +24
      velocity_scale  SMALLINT DEFAULT 100,            -- Percentage
      velocity_offset SMALLINT DEFAULT 0,

      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Clips on tracks (references to MIDI files placed on timeline)
  CREATE TABLE project_clips (
      id              BIGSERIAL PRIMARY KEY,
      track_id        BIGINT NOT NULL REFERENCES project_tracks(id) ON DELETE CASCADE,
      midi_file_id    BIGINT REFERENCES midi_files(id), -- NULL if recorded/edited in place

      -- Timeline position
      start_tick      BIGINT NOT NULL,                 -- Position on timeline
      length_ticks    BIGINT NOT NULL,                 -- Duration (may differ from source)

      -- Clip adjustments
      offset_ticks    BIGINT DEFAULT 0,                -- Offset into source MIDI
      loop_count      SMALLINT DEFAULT 1,              -- How many times to loop

      -- Clip-level transforms
      transpose       SMALLINT DEFAULT 0,
      velocity_scale  SMALLINT DEFAULT 100,

      -- Visual
      name            VARCHAR(100),                    -- Override display name
      color           VARCHAR(7),                      -- Override color

      -- If edited (not from library)
      custom_midi_data BYTEA,                          -- Inline MIDI if modified

      created_at      TIMESTAMPTZ DEFAULT NOW(),
      modified_at     TIMESTAMPTZ DEFAULT NOW()
  );

  -- Automation lanes per track
  CREATE TABLE project_automation (
      id              BIGSERIAL PRIMARY KEY,
      track_id        BIGINT NOT NULL REFERENCES project_tracks(id) ON DELETE CASCADE,

      -- What parameter is automated
      param_type      VARCHAR(20) NOT NULL,            -- 'cc', 'pitch_bend', 'velocity', etc.
      cc_number       SMALLINT,                        -- If param_type = 'cc'

      -- Automation points stored as JSONB array
      -- [{tick: 0, value: 64}, {tick: 480, value: 127}, ...]
      points          JSONB NOT NULL DEFAULT '[]',

      -- Display
      visible         BOOLEAN DEFAULT TRUE,
      color           VARCHAR(7)
  );

  -- Project markers (song sections, cue points)
  CREATE TABLE project_markers (
      id              BIGSERIAL PRIMARY KEY,
      project_id      BIGINT NOT NULL REFERENCES projects(id) ON DELETE CASCADE,

      name            VARCHAR(100) NOT NULL,
      tick            BIGINT NOT NULL,
      color           VARCHAR(7),
      marker_type     VARCHAR(20) DEFAULT 'marker'     -- marker, loop_start, loop_end, cue
  );

  -- Indexes
  CREATE INDEX idx_project_tracks_project ON project_tracks(project_id);
  CREATE INDEX idx_project_clips_track ON project_clips(track_id);
  CREATE INDEX idx_project_clips_position ON project_clips(track_id, start_tick);
  CREATE INDEX idx_project_automation_track ON project_automation(track_id);
  CREATE INDEX idx_project_markers_project ON project_markers(project_id, tick);

  ---
  3. MIXER STATE (MIDI Parameters)

  Purpose: Per-track and master MIDI parameter settings

  -- ============================================================================
  -- MIDI MIXER STATE
  -- ============================================================================

  -- Mixer channel strips (linked to tracks, but stored separately for reuse)
  CREATE TABLE mixer_channels (
      id              BIGSERIAL PRIMARY KEY,
      track_id        BIGINT UNIQUE REFERENCES project_tracks(id) ON DELETE CASCADE,

      -- MIDI Output routing
      midi_channel    SMALLINT NOT NULL DEFAULT 1,     -- 1-16
      midi_port_id    BIGINT REFERENCES midi_ports(id),

      -- ══════════════════════════════════════════════════════════════════
      -- MIDI PARAMETERS (all the knobs from the mixer window)
      -- ══════════════════════════════════════════════════════════════════

      -- Transpose
      transpose       SMALLINT DEFAULT 0,              -- -24 to +24 semitones

      -- Velocity
      velocity_scale  SMALLINT DEFAULT 100,            -- 1-200%
      velocity_min    SMALLINT DEFAULT 0,              -- 0-127 clamp
      velocity_max    SMALLINT DEFAULT 127,            -- 0-127 clamp
      velocity_offset SMALLINT DEFAULT 0,              -- -127 to +127

      -- Pitch Bend
      pitch_bend      SMALLINT DEFAULT 0,              -- -8192 to +8191

      -- Note Filter
      note_low        SMALLINT DEFAULT 0,              -- 0-127 (C-1 to G9)
      note_high       SMALLINT DEFAULT 127,            -- 0-127

      -- Timing
      quantize_grid   VARCHAR(10),                     -- NULL, '1/4', '1/8', '1/16', '1/32'
      quantize_strength SMALLINT DEFAULT 100,          -- 0-100%
      swing           SMALLINT DEFAULT 0,              -- 0-100%
      delay_ms        SMALLINT DEFAULT 0,              -- -100 to +100ms

      -- Channel state
      muted           BOOLEAN DEFAULT FALSE,
      solo            BOOLEAN DEFAULT FALSE,

      -- Program change (for selecting patches on outboard gear)
      program_change  SMALLINT,                        -- 0-127, NULL = don't send
      bank_msb        SMALLINT,                        -- 0-127
      bank_lsb        SMALLINT,                        -- 0-127

      modified_at     TIMESTAMPTZ DEFAULT NOW()
  );

  -- Master channel (applies to all tracks)
  CREATE TABLE mixer_master (
      id              BIGSERIAL PRIMARY KEY,
      project_id      BIGINT UNIQUE REFERENCES projects(id) ON DELETE CASCADE,

      -- Master MIDI transforms (applied after individual channels)
      transpose       SMALLINT DEFAULT 0,
      velocity_scale  SMALLINT DEFAULT 100,
      velocity_min    SMALLINT DEFAULT 0,
      velocity_max    SMALLINT DEFAULT 127,
      pitch_bend      SMALLINT DEFAULT 0,
      note_low        SMALLINT DEFAULT 0,
      note_high       SMALLINT DEFAULT 127,
      quantize_grid   VARCHAR(10),
      quantize_strength SMALLINT DEFAULT 100,
      swing           SMALLINT DEFAULT 0,
      delay_ms        SMALLINT DEFAULT 0,

      -- Master mute
      muted           BOOLEAN DEFAULT FALSE
  );

  -- CC assignments for each channel (which CCs are being sent)
  CREATE TABLE mixer_channel_ccs (
      id              BIGSERIAL PRIMARY KEY,
      mixer_channel_id BIGINT REFERENCES mixer_channels(id) ON DELETE CASCADE,

      cc_number       SMALLINT NOT NULL,               -- 0-127
      cc_value        SMALLINT NOT NULL DEFAULT 0,     -- 0-127
      cc_name         VARCHAR(50),                     -- User label: "Filter Cutoff"

      UNIQUE(mixer_channel_id, cc_number)
  );

  CREATE INDEX idx_mixer_channels_track ON mixer_channels(track_id);
  CREATE INDEX idx_mixer_channel_ccs_channel ON mixer_channel_ccs(mixer_channel_id);

  ---
  4. MIDI I/O CONFIGURATION

  Purpose: Hardware ports, routing, device profiles

  -- ============================================================================
  -- MIDI I/O CONFIGURATION
  -- ============================================================================

  -- Physical MIDI ports (discovered from system)
  CREATE TABLE midi_ports (
      id              BIGSERIAL PRIMARY KEY,

      -- System identification
      system_name     VARCHAR(255) NOT NULL,           -- OS-level port name
      system_id       VARCHAR(255),                    -- Unique system identifier

      -- User customization
      display_name    VARCHAR(100),                    -- User-friendly name
      alias           VARCHAR(50),                     -- Short name: "Port A", "Synth Out"

      -- Port type
      direction       VARCHAR(10) NOT NULL,            -- 'input' or 'output'
      port_type       VARCHAR(20) DEFAULT 'hardware',  -- hardware, virtual, network

      -- Connection state (updated at runtime, persisted for UI)
      is_connected    BOOLEAN DEFAULT FALSE,
      last_seen_at    TIMESTAMPTZ,

      -- Default behavior
      enabled         BOOLEAN DEFAULT TRUE,            -- User can disable ports
      auto_connect    BOOLEAN DEFAULT TRUE,            -- Reconnect on startup

      -- For outputs: default clock/transport behavior
      send_clock      BOOLEAN DEFAULT FALSE,
      send_transport  BOOLEAN DEFAULT TRUE,            -- Start/Stop/Continue

      -- For inputs: routing
      route_to        VARCHAR(20) DEFAULT 'selected',  -- selected, all, none

      UNIQUE(system_name, direction)
  );

  -- Port groups (for multi-port interfaces)
  CREATE TABLE midi_port_groups (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(100) NOT NULL,           -- "Focusrite Scarlett", "MOTU 828"
      icon            VARCHAR(50)
  );

  CREATE TABLE midi_port_group_members (
      port_group_id   BIGINT REFERENCES midi_port_groups(id) ON DELETE CASCADE,
      port_id         BIGINT REFERENCES midi_ports(id) ON DELETE CASCADE,
      sort_order      SMALLINT,
      PRIMARY KEY (port_group_id, port_id)
  );

  -- MIDI routing rules (advanced)
  CREATE TABLE midi_routes (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(100),
      enabled         BOOLEAN DEFAULT TRUE,

      -- Source
      input_port_id   BIGINT REFERENCES midi_ports(id),
      input_channel   SMALLINT,                        -- NULL = all channels

      -- Destination
      output_port_id  BIGINT REFERENCES midi_ports(id),
      output_channel  SMALLINT,                        -- NULL = pass through

      -- Filter
      filter_type     VARCHAR(20),                     -- notes, cc, program, all

      -- Transform
      transpose       SMALLINT DEFAULT 0,
      velocity_scale  SMALLINT DEFAULT 100
  );

  CREATE INDEX idx_midi_ports_direction ON midi_ports(direction);
  CREATE INDEX idx_midi_routes_input ON midi_routes(input_port_id);

  ---
  5. USER PREFERENCES

  Purpose: App settings, UI state, keyboard shortcuts

  -- ============================================================================
  -- USER PREFERENCES
  -- ============================================================================

  -- Single-row settings table (key-value with types)
  CREATE TABLE settings (
      key             VARCHAR(100) PRIMARY KEY,
      value           TEXT,
      value_type      VARCHAR(20) DEFAULT 'string',    -- string, int, float, bool, json
      category        VARCHAR(50),                     -- general, audio, midi, ui, keyboard
      modified_at     TIMESTAMPTZ DEFAULT NOW()
  );

  -- Default settings
  INSERT INTO settings (key, value, value_type, category) VALUES
      -- General
      ('app.language', 'en', 'string', 'general'),
      ('app.theme', 'dark', 'string', 'general'),
      ('app.auto_save', 'true', 'bool', 'general'),
      ('app.auto_save_interval', '60', 'int', 'general'),
      ('app.recent_projects_count', '10', 'int', 'general'),

      -- MIDI
      ('midi.default_channel', '1', 'int', 'midi'),
      ('midi.default_velocity', '100', 'int', 'midi'),
      ('midi.clock_source', 'internal', 'string', 'midi'),
      ('midi.send_clock', 'true', 'bool', 'midi'),
      ('midi.send_transport', 'true', 'bool', 'midi'),

      -- UI
      ('ui.browser_position', 'left', 'string', 'ui'),
      ('ui.preview_visible', 'true', 'bool', 'ui'),
      ('ui.mixer_visible', 'true', 'bool', 'ui'),
      ('ui.sequencer_zoom', '1.0', 'float', 'ui'),
      ('ui.track_height_default', '80', 'int', 'ui'),

      -- Browser
      ('browser.view_mode', 'list', 'string', 'browser'),
      ('browser.sort_by', 'name', 'string', 'browser'),
      ('browser.sort_order', 'asc', 'string', 'browser'),
      ('browser.page_size', '25', 'int', 'browser'),
      ('browser.show_preview', 'true', 'bool', 'browser'),

      -- Import
      ('import.auto_tag', 'true', 'bool', 'import'),
      ('import.analyze_bpm', 'true', 'bool', 'import'),
      ('import.analyze_key', 'true', 'bool', 'import'),
      ('import.duplicate_action', 'skip', 'string', 'import');

  -- Window layouts (Pro Tools style)
  CREATE TABLE window_layouts (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(100) NOT NULL,
      is_default      BOOLEAN DEFAULT FALSE,

      -- Store complete window state as JSON
      -- {windows: [{id, x, y, width, height, state, docked, tabbedWith}, ...]}
      layout_data     JSONB NOT NULL,

      created_at      TIMESTAMPTZ DEFAULT NOW(),
      modified_at     TIMESTAMPTZ DEFAULT NOW()
  );

  -- Insert default layouts
  INSERT INTO window_layouts (name, is_default, layout_data) VALUES
      ('Browse & Edit', TRUE, '{"windows": [
          {"id": "database", "x": 0, "y": 0, "width": 400, "height": 600, "state": "normal", "docked": "left"},
          {"id": "preview", "x": 0, "y": 600, "width": 400, "height": 300, "state": "normal", "docked": "left"},
          {"id": "sequencer", "x": 400, "y": 0, "width": 800, "height": 900, "state": "normal", "docked": "float"}
      ]}'),
      ('Performance', FALSE, '{"windows": [
          {"id": "sequencer", "x": 0, "y": 0, "width": 1000, "height": 500, "state": "normal"},
          {"id": "mixer", "x": 0, "y": 500, "width": 1000, "height": 400, "state": "normal"}
      ]}'),
      ('Full Edit', FALSE, '{"windows": [
          {"id": "database", "x": 0, "y": 0, "width": 300, "height": 450, "state": "normal"},
          {"id": "sequencer", "x": 300, "y": 0, "width": 700, "height": 450, "state": "normal"},
          {"id": "mixer", "x": 0, "y": 450, "width": 500, "height": 350, "state": "normal"},
          {"id": "piano_roll", "x": 500, "y": 450, "width": 500, "height": 350, "state": "normal"}
      ]}');

  -- Keyboard shortcuts (customizable)
  CREATE TABLE keyboard_shortcuts (
      id              BIGSERIAL PRIMARY KEY,
      action          VARCHAR(100) NOT NULL UNIQUE,    -- 'transport.play', 'edit.undo', etc.
      shortcut        VARCHAR(50) NOT NULL,            -- 'Space', 'Cmd+Z', 'Ctrl+Shift+S'
      category        VARCHAR(50),
      description     TEXT,
      is_custom       BOOLEAN DEFAULT FALSE            -- TRUE if user modified
  );

  -- Default shortcuts
  INSERT INTO keyboard_shortcuts (action, shortcut, category, description) VALUES
      -- Transport
      ('transport.play', 'Space', 'transport', 'Play / Pause'),
      ('transport.stop', 'Enter', 'transport', 'Stop'),
      ('transport.record', 'R', 'transport', 'Toggle Record'),
      ('transport.loop', 'L', 'transport', 'Toggle Loop'),
      ('transport.rewind', ',', 'transport', 'Rewind'),
      ('transport.forward', '.', 'transport', 'Forward'),
      ('transport.goto_start', 'Home', 'transport', 'Go to Start'),
      ('transport.goto_end', 'End', 'transport', 'Go to End'),

      -- Edit
      ('edit.undo', 'Cmd+Z', 'edit', 'Undo'),
      ('edit.redo', 'Cmd+Shift+Z', 'edit', 'Redo'),
      ('edit.cut', 'Cmd+X', 'edit', 'Cut'),
      ('edit.copy', 'Cmd+C', 'edit', 'Copy'),
      ('edit.paste', 'Cmd+V', 'edit', 'Paste'),
      ('edit.delete', 'Backspace', 'edit', 'Delete'),
      ('edit.select_all', 'Cmd+A', 'edit', 'Select All'),
      ('edit.duplicate', 'Cmd+D', 'edit', 'Duplicate'),

      -- Track
      ('track.mute', 'M', 'track', 'Mute Selected Track'),
      ('track.solo', 'S', 'track', 'Solo Selected Track'),
      ('track.arm', 'Shift+R', 'track', 'Arm Selected Track'),
      ('track.new', 'Cmd+T', 'track', 'New Track'),

      -- Windows
      ('window.database', 'Cmd+1', 'window', 'Show/Hide Database'),
      ('window.sequencer', 'Cmd+2', 'window', 'Show/Hide Sequencer'),
      ('window.mixer', 'Cmd+3', 'window', 'Show/Hide Mixer'),
      ('window.piano_roll', 'Cmd+4', 'window', 'Show/Hide Piano Roll'),
      ('window.monitor', 'Cmd+5', 'window', 'Show/Hide MIDI Monitor'),
      ('window.io_setup', 'Cmd+6', 'window', 'Show/Hide I/O Setup'),
      ('window.command_palette', 'Cmd+K', 'window', 'Command Palette'),

      -- File
      ('file.new', 'Cmd+N', 'file', 'New Project'),
      ('file.open', 'Cmd+O', 'file', 'Open Project'),
      ('file.save', 'Cmd+S', 'file', 'Save Project'),
      ('file.save_as', 'Cmd+Shift+S', 'file', 'Save Project As'),
      ('file.export', 'Cmd+E', 'file', 'Export MIDI'),

      -- Browser
      ('browser.search', 'Cmd+F', 'browser', 'Focus Search'),
      ('browser.preview', 'P', 'browser', 'Preview Selected');

  -- Recent projects
  CREATE TABLE recent_projects (
      id              BIGSERIAL PRIMARY KEY,
      project_id      BIGINT REFERENCES projects(id) ON DELETE CASCADE,
      file_path       TEXT,                            -- For projects saved to disk
      opened_at       TIMESTAMPTZ DEFAULT NOW()
  );

  CREATE INDEX idx_recent_projects_opened ON recent_projects(opened_at DESC);

  ---
  6. OUTBOARD GEAR PROFILES

  Purpose: Define hardware synths/drum machines with their MIDI specs

  -- ============================================================================
  -- OUTBOARD GEAR PROFILES
  -- ============================================================================

  -- Hardware device definitions
  CREATE TABLE gear_profiles (
      id              BIGSERIAL PRIMARY KEY,

      -- Basic info
      name            VARCHAR(100) NOT NULL,           -- "Roland TR-808"
      manufacturer    VARCHAR(100),                    -- "Roland"
      category        VARCHAR(50),                     -- synth, drum_machine, sampler, effect

      -- Image/icon
      image_path      TEXT,
      icon            VARCHAR(50),

      -- MIDI specs
      midi_channels   SMALLINT[] DEFAULT '{1}',        -- Channels it responds to
      is_multitimbral BOOLEAN DEFAULT FALSE,

      -- User data
      notes           TEXT,
      is_favorite     BOOLEAN DEFAULT FALSE,
      is_custom       BOOLEAN DEFAULT TRUE,            -- FALSE for factory presets

      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- CC mappings for each gear profile
  CREATE TABLE gear_cc_mappings (
      id              BIGSERIAL PRIMARY KEY,
      gear_profile_id BIGINT REFERENCES gear_profiles(id) ON DELETE CASCADE,

      cc_number       SMALLINT NOT NULL,               -- 0-127
      name            VARCHAR(100) NOT NULL,           -- "Filter Cutoff"
      min_value       SMALLINT DEFAULT 0,
      max_value       SMALLINT DEFAULT 127,
      default_value   SMALLINT DEFAULT 64,

      -- For display
      display_type    VARCHAR(20) DEFAULT 'knob',      -- knob, slider, switch, dropdown

      UNIQUE(gear_profile_id, cc_number)
  );

  -- Program/Patch names for gear
  CREATE TABLE gear_programs (
      id              BIGSERIAL PRIMARY KEY,
      gear_profile_id BIGINT REFERENCES gear_profiles(id) ON DELETE CASCADE,

      program_number  SMALLINT NOT NULL,               -- 0-127
      bank_msb        SMALLINT DEFAULT 0,
      bank_lsb        SMALLINT DEFAULT 0,
      name            VARCHAR(100) NOT NULL,           -- "Acid Bass"
      category        VARCHAR(50),

      UNIQUE(gear_profile_id, bank_msb, bank_lsb, program_number)
  );

  -- User's gear instances (their actual hardware)
  CREATE TABLE user_gear (
      id              BIGSERIAL PRIMARY KEY,
      gear_profile_id BIGINT REFERENCES gear_profiles(id),

      -- User customization
      nickname        VARCHAR(100),                    -- "My 808 Clone"

      -- MIDI routing
      midi_port_id    BIGINT REFERENCES midi_ports(id),
      midi_channel    SMALLINT DEFAULT 1,

      -- Notes
      notes           TEXT,

      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Pre-populate some common gear
  INSERT INTO gear_profiles (name, manufacturer, category, is_custom) VALUES
      ('TR-808', 'Roland', 'drum_machine', FALSE),
      ('TR-909', 'Roland', 'drum_machine', FALSE),
      ('TB-303', 'Roland', 'synth', FALSE),
      ('Juno-106', 'Roland', 'synth', FALSE),
      ('DX7', 'Yamaha', 'synth', FALSE),
      ('Minimoog', 'Moog', 'synth', FALSE),
      ('Sub 37', 'Moog', 'synth', FALSE),
      ('MicroKorg', 'Korg', 'synth', FALSE),
      ('Volca Keys', 'Korg', 'synth', FALSE),
      ('Volca Beats', 'Korg', 'drum_machine', FALSE),
      ('Digitakt', 'Elektron', 'sampler', FALSE),
      ('Digitone', 'Elektron', 'synth', FALSE),
      ('Prophet-5', 'Sequential', 'synth', FALSE),
      ('OB-6', 'Sequential', 'synth', FALSE),
      ('Bass Station II', 'Novation', 'synth', FALSE),
      ('Circuit Tracks', 'Novation', 'groovebox', FALSE),
      ('MPC One', 'Akai', 'sampler', FALSE),
      ('Hydrasynth', 'ASM', 'synth', FALSE),
      ('Minilogue XD', 'Korg', 'synth', FALSE),
      ('Peak', 'Novation', 'synth', FALSE);

  CREATE INDEX idx_gear_profiles_category ON gear_profiles(category);
  CREATE INDEX idx_gear_cc_mappings_profile ON gear_cc_mappings(gear_profile_id);
  CREATE INDEX idx_user_gear_profile ON user_gear(gear_profile_id);

  ---
  7. PRESETS & TEMPLATES

  Purpose: Reusable mixer settings, track templates, project templates

  -- ============================================================================
  -- PRESETS & TEMPLATES
  -- ============================================================================

  -- Mixer channel presets (save/recall channel strip settings)
  CREATE TABLE mixer_presets (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(100) NOT NULL,
      category        VARCHAR(50),                     -- bass, drums, synth, etc.

      -- All the mixer settings as JSON
      settings        JSONB NOT NULL,

      -- For gear association
      gear_profile_id BIGINT REFERENCES gear_profiles(id),

      is_factory      BOOLEAN DEFAULT FALSE,
      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Track templates (track + mixer settings)
  CREATE TABLE track_templates (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(100) NOT NULL,
      category        VARCHAR(50),

      -- Track settings
      track_settings  JSONB NOT NULL,                  -- name, color, icon
      mixer_settings  JSONB NOT NULL,                  -- All mixer params

      -- Associated gear
      gear_profile_id BIGINT REFERENCES gear_profiles(id),

      is_factory      BOOLEAN DEFAULT FALSE,
      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Project templates (complete project setup)
  CREATE TABLE project_templates (
      id              BIGSERIAL PRIMARY KEY,
      name            VARCHAR(100) NOT NULL,
      description     TEXT,
      category        VARCHAR(50),                     -- genre or purpose

      -- Complete project as JSON (tracks, mixer, markers)
      template_data   JSONB NOT NULL,

      -- Preview
      thumbnail_path  TEXT,

      is_factory      BOOLEAN DEFAULT FALSE,
      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Factory templates
  INSERT INTO project_templates (name, description, category, template_data, is_factory) VALUES
      ('Empty Project', 'Blank project with no tracks', 'basic', '{"tracks": [], "bpm": 120}', TRUE),
      ('4 Track', '4 tracks for drums, bass, lead, pad', 'basic', '{"tracks": [
          {"name": "Drums", "channel": 10, "color": "#FF5733"},
          {"name": "Bass", "channel": 2, "color": "#3498DB"},
          {"name": "Lead", "channel": 1, "color": "#2ECC71"},
          {"name": "Pad", "channel": 3, "color": "#9B59B6"}
      ], "bpm": 120}', TRUE),
      ('8 Track', '8 tracks for full arrangement', 'basic', '{"tracks": [
          {"name": "Kick", "channel": 10},
          {"name": "Snare", "channel": 10},
          {"name": "Hats", "channel": 10},
          {"name": "Perc", "channel": 10},
          {"name": "Bass", "channel": 2},
          {"name": "Lead", "channel": 1},
          {"name": "Pad", "channel": 3},
          {"name": "FX", "channel": 4}
      ], "bpm": 120}', TRUE),
      ('Hip-Hop', 'Hip-Hop template at 90 BPM', 'genre', '{"tracks": [
          {"name": "Drums", "channel": 10},
          {"name": "808 Bass", "channel": 2},
          {"name": "Melody", "channel": 1},
          {"name": "Chops", "channel": 3}
      ], "bpm": 90}', TRUE),
      ('Techno', 'Techno template at 130 BPM', 'genre', '{"tracks": [
          {"name": "Kick", "channel": 10},
          {"name": "Hats", "channel": 10},
          {"name": "Perc", "channel": 10},
          {"name": "Bass", "channel": 2},
          {"name": "Lead", "channel": 1},
          {"name": "Pad", "channel": 3}
      ], "bpm": 130}', TRUE);

  CREATE INDEX idx_mixer_presets_category ON mixer_presets(category);
  CREATE INDEX idx_track_templates_category ON track_templates(category);
  CREATE INDEX idx_project_templates_category ON project_templates(category);

  ---
  8. HISTORY & UNDO

  Purpose: Audit trail, undo/redo stack, activity log

  -- ============================================================================
  -- HISTORY & UNDO
  -- ============================================================================

  -- Undo stack per project (in-memory during session, persisted for crash recovery)
  CREATE TABLE undo_stack (
      id              BIGSERIAL PRIMARY KEY,
      project_id      BIGINT REFERENCES projects(id) ON DELETE CASCADE,

      -- Action info
      action_type     VARCHAR(50) NOT NULL,            -- 'clip.move', 'track.add', 'mixer.change'
      action_name     VARCHAR(100) NOT NULL,           -- Human readable: "Move clip"

      -- State before action (for undo)
      before_state    JSONB NOT NULL,

      -- State after action (for redo)
      after_state     JSONB NOT NULL,

      -- Stack position
      stack_index     INTEGER NOT NULL,

      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Activity log (non-undoable events, for analytics/debugging)
  CREATE TABLE activity_log (
      id              BIGSERIAL PRIMARY KEY,

      event_type      VARCHAR(50) NOT NULL,            -- 'file.import', 'project.open', 'export'
      event_data      JSONB,

      -- Context
      project_id      BIGINT REFERENCES projects(id) ON DELETE SET NULL,
      midi_file_id    BIGINT REFERENCES midi_files(id) ON DELETE SET NULL,

      created_at      TIMESTAMPTZ DEFAULT NOW()
  );

  -- Import history (for debugging import issues)
  CREATE TABLE import_history (
      id              BIGSERIAL PRIMARY KEY,

      source_path     TEXT NOT NULL,
      file_count      INTEGER,
      success_count   INTEGER,
      error_count     INTEGER,

      -- Errors as JSON array
      errors          JSONB,

      started_at      TIMESTAMPTZ DEFAULT NOW(),
      completed_at    TIMESTAMPTZ
  );

  CREATE INDEX idx_undo_stack_project ON undo_stack(project_id, stack_index);
  CREATE INDEX idx_activity_log_type ON activity_log(event_type);
  CREATE INDEX idx_activity_log_time ON activity_log(created_at DESC);

  ---
  SUMMARY: ALL DATA DOMAINS

  | Domain         | Tables    | Purpose                                               |
  |----------------|-----------|-------------------------------------------------------|
  | 1. MIDI Files  | 12 tables | Library browser with VIP3-style filtering             |
  | 2. Projects    | 5 tables  | Sequencer arrangements with tracks, clips, automation |
  | 3. Mixer       | 3 tables  | Per-track and master MIDI parameters                  |
  | 4. MIDI I/O    | 4 tables  | Port configuration, routing, sync                     |
  | 5. Preferences | 4 tables  | Settings, window layouts, shortcuts                   |
  | 6. Gear        | 4 tables  | Outboard hardware profiles and CC maps                |
  | 7. Presets     | 3 tables  | Reusable mixer/track/project templates                |
  | 8. History     | 3 tables  | Undo stack, activity log, import history              |

  Total: ~38 tables

  ---
  DATABASE STRUCTURE VISUALIZATION

  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                              DATABASE SCHEMA                                 │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │                                                                              │
  │  LIBRARY (VIP3-style)              PROJECTS (DAW-style)                     │
  │  ┌───────────────────┐             ┌───────────────────┐                    │
  │  │ midi_files        │             │ projects          │                    │
  │  │ ├─ folders        │             │ ├─ project_tracks │                    │
  │  │ ├─ instruments    │             │ │   ├─ project_clips                   │
  │  │ ├─ timbres        │             │ │   └─ project_automation              │
  │  │ ├─ styles         │             │ ├─ project_markers                     │
  │  │ ├─ articulations  │             │ └─ mixer_master                        │
  │  │ ├─ bpm_ranges     │             └───────────────────┘                    │
  │  │ ├─ musical_keys   │                                                       │
  │  │ ├─ tags           │             MIXER                                     │
  │  │ ├─ collections    │             ┌───────────────────┐                    │
  │  │ └─ saved_searches │             │ mixer_channels    │                    │
  │  └───────────────────┘             │ └─ mixer_channel_ccs                   │
  │                                     └───────────────────┘                    │
  │  MIDI I/O                          GEAR                                      │
  │  ┌───────────────────┐             ┌───────────────────┐                    │
  │  │ midi_ports        │             │ gear_profiles     │                    │
  │  │ ├─ midi_port_groups             │ ├─ gear_cc_mappings                    │
  │  │ └─ midi_routes    │             │ ├─ gear_programs  │                    │
  │  └───────────────────┘             │ └─ user_gear      │                    │
  │                                     └───────────────────┘                    │
  │  PREFERENCES                       PRESETS                                   │
  │  ┌───────────────────┐             ┌───────────────────┐                    │
  │  │ settings          │             │ mixer_presets     │                    │
  │  │ window_layouts    │             │ track_templates   │                    │
  │  │ keyboard_shortcuts│             │ project_templates │                    │
  │  │ recent_projects   │             └───────────────────┘                    │
  │  └───────────────────┘                                                       │
  │                                     HISTORY                                  │
  │                                     ┌───────────────────┐                    │
  │                                     │ undo_stack        │                    │
  │                                     │ activity_log      │                    │
  │                                     │ import_history    │                    │
  │                                     └───────────────────┘                    │
  │                                                                              │
  └─────────────────────────────────────────────────────────────────────────────┘

  ---
  Want me to create the migration files to add these new tables to the MIDI Software Center database?

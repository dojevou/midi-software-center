# Testing Quick Start - Critical Fixes Verification

**Quick reference for running tests on the 3 critical Tauri integration fixes**

## TL;DR - Run All Tests

```bash
# Terminal 1: Start dev server
cd /home/dojevou/projects/midi-software-center
pnpm dev

# Terminal 2: Run automated tests
npx playwright test e2e/critical-fixes.puppeteer.spec.ts --reporter=html
npx playwright show-report
```

## Three Testing Approaches

### 1. Automated Playwright Tests (Recommended)

**Best for:** CI/CD, regression testing, quick verification

```bash
# Install dependencies
npm install -D @playwright/test

# Run all tests
npx playwright test e2e/critical-fixes.puppeteer.spec.ts

# Run specific suite
npx playwright test -g "MIDI I/O"
npx playwright test -g "Export"
npx playwright test -g "VIP3"

# Visual debugging
npx playwright test --headed --debug
```

**See:** [PUPPETEER_TESTING_GUIDE.md](PUPPETEER_TESTING_GUIDE.md)

---

### 2. Manual Testing Checklist (Human QA)

**Best for:** Exploratory testing, UX verification, edge cases

**Location:** [MANUAL_TESTING_CHECKLIST.md](MANUAL_TESTING_CHECKLIST.md)

**Includes:**
- 23 detailed test cases
- Step-by-step instructions
- Expected results
- Pass/fail criteria
- Debugging tips

**Usage:** Open file and follow checklist while using the app

---

### 3. Interactive Puppeteer MCP (Claude Code)

**Best for:** Debugging, screenshot capture, custom test flows

**Location:** [PUPPETEER_MCP_TEST_SCRIPT.md](PUPPETEER_MCP_TEST_SCRIPT.md)

**Includes:**
- Step-by-step Puppeteer commands
- Screenshot capture instructions
- Console error checking
- API call verification

**Usage:** Follow script and ask Claude Code to run Puppeteer MCP tools

---

## Test Coverage Summary

| Issue | Tests | Methods |
|-------|-------|---------|
| **#1: MIDI I/O Commands** | 8 tests | Auto + Manual + MCP |
| **#2: Export Functionality** | 7 tests | Auto + Manual + MCP |
| **#3: VIP3→DAW Loading** | 8 tests | Auto + Manual + MCP |
| **Integration Tests** | 3 tests | Auto + Manual |
| **Total Coverage** | **26 tests** | All 3 methods |

## Quick Test Scenarios

### Scenario 1: Pre-Commit Verification

**Goal:** Ensure fixes still work before committing

```bash
# Quick automated check (2 minutes)
pnpm dev &
sleep 10
npx playwright test e2e/critical-fixes.puppeteer.spec.ts --reporter=line
```

---

### Scenario 2: QA Review

**Goal:** Full manual verification before release

1. Start app: `pnpm dev`
2. Open [MANUAL_TESTING_CHECKLIST.md](MANUAL_TESTING_CHECKLIST.md)
3. Execute all 26 test cases
4. Fill out test summary at end of checklist
5. Document any failures

---

### Scenario 3: Debug Specific Issue

**Goal:** Investigate a specific failing component

1. Start app: `pnpm dev`
2. Open [PUPPETEER_MCP_TEST_SCRIPT.md](PUPPETEER_MCP_TEST_SCRIPT.md)
3. Use Claude Code to run Puppeteer commands
4. Take screenshots at each step
5. Check console for errors
6. Verify API calls

---

## Expected Test Results

### ✅ All Passing (Target State)

```
Automated: 17/17 tests passing
Manual:    26/26 test cases verified
MCP:       All screenshots captured, no console errors
```

### ⚠️ Partial Pass (Investigate)

```
Automated: 15/17 tests passing (check which failed)
Manual:    22/26 test cases verified (document failures)
MCP:       Some console warnings (verify if critical)
```

### ❌ Critical Failure (Fix Required)

**Any of these errors indicate fixes are broken:**

```
❌ Command midi_io_get_state not found
❌ Command load_file_to_daw not found
❌ api.export.exportProject is not a function
❌ TypeError in any of the 3 fix areas
```

## Test Files Location

```
midi-software-center/
├── e2e/
│   ├── app.spec.ts                      # Original Playwright tests
│   └── critical-fixes.puppeteer.spec.ts # NEW: Automated critical fix tests
├── docs/
│   ├── MANUAL_TESTING_CHECKLIST.md      # NEW: Human testing guide
│   ├── PUPPETEER_TESTING_GUIDE.md       # NEW: Automated test docs
│   ├── PUPPETEER_MCP_TEST_SCRIPT.md     # NEW: Interactive MCP script
│   └── TESTING_QUICK_START.md           # NEW: This file
└── tests/
    └── screenshots/                      # Generated by tests
        ├── midi-io-dialog.png
        ├── export-dialog.png
        └── vip3-browser.png
```

## Prerequisites for Testing

### Required

1. **Dev server running:**
   ```bash
   pnpm dev
   # App must be accessible at http://localhost:5173
   ```

2. **Database populated:**
   ```bash
   # Ensure MIDI files exist for VIP3 browser testing
   ./scripts/run-pipeline-ultra-fast.sh
   ```

3. **Playwright installed:**
   ```bash
   npm install -D @playwright/test
   npx playwright install
   ```

### Optional

4. **Virtual MIDI port (for MIDI I/O testing):**
   ```bash
   # Linux
   sudo modprobe snd-virmidi

   # macOS
   # Use Audio MIDI Setup app to create IAC bus
   ```

## CI/CD Integration

### GitHub Actions Example

```yaml
name: Test Critical Fixes

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - name: Install dependencies
        run: pnpm install
      - name: Build Tauri app
        run: cd app/src-tauri && cargo build
      - name: Start dev server
        run: pnpm dev &
      - name: Wait for server
        run: sleep 15
      - name: Run Playwright tests
        run: npx playwright test e2e/critical-fixes.puppeteer.spec.ts
      - name: Upload screenshots
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: test-screenshots
          path: tests/screenshots/
```

## Troubleshooting

### Tests Won't Run

**Error:** `net::ERR_CONNECTION_REFUSED at http://localhost:5173`

**Solution:**
```bash
# Ensure dev server is running
pnpm dev
# Wait 10-15 seconds for server to start
# Then run tests
```

---

### Tests Fail on CI

**Error:** Tests pass locally but fail in CI

**Solution:**
```bash
# Increase wait times in CI environment
# Check GitHub Actions logs for browser console errors
# Ensure database is populated in CI
```

---

### Screenshots Not Generated

**Error:** `tests/screenshots/` folder empty

**Solution:**
```bash
# Create directory first
mkdir -p tests/screenshots

# Run tests with headed browser to debug
npx playwright test --headed
```

---

### MIDI I/O Tests Fail

**Error:** "No MIDI devices found"

**Solution:**
```bash
# Tests should pass even without physical devices
# Virtual ports can be used for full testing
# Check if backend gracefully handles no devices
```

## Performance Expectations

| Test Type | Duration | When to Use |
|-----------|----------|-------------|
| Automated (all) | ~30-40s | Pre-commit, CI/CD |
| Automated (single suite) | ~10-15s | Quick check |
| Manual (full) | ~30-45min | Release verification |
| Manual (single issue) | ~10-15min | Bug investigation |
| MCP Interactive | ~5-10min | Debugging, screenshots |

## Next Steps After Testing

### If Tests Pass ✅

1. Commit changes
2. Create pull request
3. Run manual checklist one more time
4. Merge to main

### If Tests Fail ❌

1. Check which specific test failed
2. Review error messages in test output
3. Use Puppeteer MCP script to debug interactively
4. Fix the issue
5. Re-run tests
6. Document fix in commit message

## Related Documentation

- [Tauri Integration Audit Report](TAURI_INTEGRATION_AUDIT_REPORT.md) - Original issues
- [Manual Testing Checklist](MANUAL_TESTING_CHECKLIST.md) - Detailed test procedures
- [Puppeteer Testing Guide](PUPPETEER_TESTING_GUIDE.md) - Automated test details
- [Puppeteer MCP Script](PUPPETEER_MCP_TEST_SCRIPT.md) - Interactive testing

---

**Last Updated:** 2025-12-16
**Status:** Testing framework complete, ready for execution
**Coverage:** 26 tests across 3 testing methodologies
